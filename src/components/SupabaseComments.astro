---
// 安全的 Supabase 评论组件
const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;

// 检查环境变量是否存在
const isSupabaseConfigured = supabaseUrl && supabaseAnonKey;
let supabase = null;

if (isSupabaseConfigured) {
  // 只有在环境变量存在时才初始化 Supabase
  const { createClient } = await import('@supabase/supabase-js');
  supabase = createClient(supabaseUrl, supabaseAnonKey);
}
---

<div class="comments-section">
  {isSupabaseConfigured ? (
    <!-- 如果配置正确，显示真实评论组件 -->
    <div id="comments-container">
      <h3 class="text-xl font-bold mb-4">评论</h3>
      <div id="comments-list" class="mb-4">
        <p>加载评论中...</p>
      </div>
      <!-- 评论表单等 -->
    </div>
  ) : (
    <!-- 如果配置缺失，显示友好提示 -->
    <div class="p-6 bg-yellow-100 border border-yellow-400 rounded-lg">
      <h3 class="text-lg font-semibold text-yellow-800 mb-2">
        <i class="fas fa-info-circle mr-2"></i>
        评论功能暂不可用
      </h3>
      <p class="text-yellow-700">
        评论系统配置需要更新，请稍后再试。
      </p>
    </div>
  )}
</div>

<script>
// 客户端评论功能
if (import.meta.env.PUBLIC_SUPABASE_URL && import.meta.env.PUBLIC_SUPABASE_ANON_KEY) {
  // 只有环境变量存在时才加载评论功能
  import('@supabase/supabase-js').then(({ createClient }) => {
    const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
    const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
    
    if (supabaseUrl && supabaseAnonKey) {
      const supabase = createClient(supabaseUrl, supabaseAnonKey);
      // 这里添加你的评论加载逻辑
      console.log('评论功能已启用');
    }
  });
}
</script>

<style>
.comments-section {
  margin: 2rem 0;
}
</style>