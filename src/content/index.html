<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown文档生成工具（含相册管理功能）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        neutral: '#64748B',
                        light: '#F8FAFC',
                        dark: '#1E293B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.02);
            }
            .transition-smooth {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            .tab-active {
                border-bottom: 2px solid #4F46E5;
                color: #4F46E5;
                font-weight: 500;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .album-image-input {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
            }
            .migration-notice {
                background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
                border-left: 4px solid #3b82f6;
                padding: 1rem;
                margin: 1rem 0;
                border-radius: 0 0.5rem 0.5rem 0;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen font-sans text-dark">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="text-center mb-10">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-primary mb-2 tracking-tight">
                <i class="fa fa-file-text-o mr-3" aria-hidden="true"></i>Firef、文档生成器
            </h1>
            <p class="text-neutral text-lg max-w-2xl mx-auto">用于帖子文档与日记文档快速生成，支持为Doulor的博客帖子与日记编辑，新增相册管理功能。</p>
        </header>

        <div class="migration-notice">
            <div class="flex items-start">
                <i class="fa fa-rocket text-blue-500 text-xl mt-0.5 mr-3" aria-hidden="true"></i>
                <div>
                    <h3 class="font-semibold text-blue-800">想要更便捷的内容管理？</h3>
                    <p class="text-blue-700 mt-1">
                        现在可以使用增强版编辑器实现在线编辑并自动推送到 GitHub！
                        <a href="/my-editor/" class="text-blue-600 hover:underline font-medium">使用增强版编辑器</a>
                    </p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white rounded-2xl p-6 card-shadow transform hover:scale-[1.01] transition-smooth">
                <div class="flex border-b border-slate-200 mb-6">
                    <button id="normalTab" class="tab-btn py-2 px-6 text-left transition-smooth tab-active" data-target="normalForm">
                        <i class="fa fa-file-text mr-2" aria-hidden="true"></i>帖子文档
                    </button>
                    <button id="diaryTab" class="tab-btn py-2 px-6 text-left text-neutral transition-smooth" data-target="diaryForm">
                        <i class="fa fa-book mr-2" aria-hidden="true"></i>日记文档
                    </button>
                    <button id="albumTab" class="tab-btn py-2 px-6 text-left text-neutral transition-smooth" data-target="albumForm">
                        <i class="fa fa-picture-o mr-2" aria-hidden="true"></i>相册配置
                    </button>
                </div>

                <!-- 帖子表单 -->
                <form id="normalForm" class="form-content space-y-5">
                    <div class="space-y-2">
                        <label for="normalTitle" class="block text-sm font-medium text-neutral">标题 <span class="text-red-500">*</span></label>
                        <input type="text" id="normalTitle" name="normalTitle" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：我的中文帖子">
                    </div>
                    <div class="space-y-2">
                        <label for="normalPublished" class="block text-sm font-medium text-neutral">发布日期</label>
                        <input type="date" id="normalPublished" name="normalPublished"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                    </div>
                    <div class="space-y-2">
                        <label for="normalDescription" class="block text-sm font-medium text-neutral">描述</label>
                        <textarea id="normalDescription" name="normalDescription" rows="2"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth resize-none"
                            placeholder="添加文档描述信息"></textarea>
                    </div>
                    <div class="space-y-2">
                        <label for="normalTags" class="block text-sm font-medium text-neutral">标签 (用逗号分隔)</label>
                        <input type="text" id="normalTags" name="normalTags"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：诗歌，测试">
                    </div>
                    <div class="space-y-2">
                        <label for="normalCategory" class="block text-sm font-medium text-neutral">分类</label>
                        <input type="text" id="normalCategory" name="normalCategory"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：创作">
                    </div>

                    <!-- 所有复选框选项组合在一起 -->
                    <div class="space-y-4 pt-2">
                        <!-- 图片选项 -->
                        <div>
                            <div class="flex items-center space-x-2 mb-3">
                                <input type="checkbox" id="normalUseImage" name="normalUseImage"
                                    class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                                <label for="normalUseImage" class="text-sm font-medium text-neutral">添加封面图片</label>
                            </div>
                            <div id="normalImageSection" class="hidden pl-7 space-y-2 fade-in">
                                <label for="normalImage" class="block text-sm font-medium text-neutral">图片文件名（含后缀）</label>
                                <input type="text" id="normalImage" name="normalImage"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                                    placeholder="例如：online.jpg">
                            </div>
                        </div>

                        <!-- 设为草稿 -->
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="normalDraft" name="normalDraft"
                                class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                            <label for="normalDraft" class="text-sm font-medium text-neutral">设为草稿</label>
                        </div>

                        <!-- 密码保护 -->
                        <div>
                            <div class="flex items-center space-x-2 mb-3">
                                <input type="checkbox" id="normalUsePassword" name="normalUsePassword"
                                    class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                                <label for="normalUsePassword" class="text-sm font-medium text-neutral">设置密码保护</label>
                            </div>
                            <div id="normalPasswordSection" class="hidden pl-7 space-y-2 fade-in">
                                <label for="normalPassword" class="block text-sm font-medium text-neutral">密码</label>
                                <input type="text" id="normalPassword" name="normalPassword" value="666999"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                            </div>
                        </div>

                        <!-- 置顶帖子 -->
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="normalPinned" name="normalPinned"
                                class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                            <label for="normalPinned" class="text-sm font-medium text-neutral">置顶帖子</label>
                        </div>
                    </div>
                    <!-- 复选框组合结束 -->

                    <div class="space-y-2 pt-3">
                        <label for="normalContent" class="block text-sm font-medium text-neutral">正文内容</label>
                        <textarea id="normalContent" name="normalContent" rows="6"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth resize-none"
                            placeholder="请输入文档正文内容..."></textarea>
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="generate-btn w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-xl transition-smooth flex items-center justify-center" data-type="normal">
                            <i class="fa fa-magic mr-2" aria-hidden="true"></i>生成帖子文档
                        </button>
                    </div>
                </form>

                <!-- 日记表单 -->
                <form id="diaryForm" class="form-content space-y-5 hidden">
                    <div class="space-y-2">
                        <label for="diaryTitle" class="block text-sm font-medium text-neutral">日记标题 <span class="text-red-500">*</span></label>
                        <input type="text" id="diaryTitle" name="diaryTitle" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：我的中文日记">
                    </div>
                    <div class="space-y-2">
                        <label for="diaryDate" class="block text-sm font-medium text-neutral">日记日期</label>
                        <input type="date" id="diaryDate" name="diaryDate"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                    </div>
                    <!-- 日记图片开关部分 -->
                    <div class="pt-2">
                        <div class="flex items-center space-x-2 mb-3">
                            <input type="checkbox" id="diaryUseImage" name="diaryUseImage"
                                class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                            <label for="diaryUseImage" class="text-sm font-medium text-neutral">添加图片</label>
                        </div>
                        <div id="diaryImageSection" class="hidden pl-7 space-y-3 fade-in">
                            <label class="block text-sm font-medium text-neutral">图片文件名或外部链接</label>
                            <div id="diaryImagesContainer" class="space-y-2">
                                <!-- 图片输入框将动态添加到这里 -->
                            </div>
                            <button type="button" id="addImageBtn" class="text-sm text-primary hover:text-primary/80 transition-smooth flex items-center">
                                <i class="fa fa-plus mr-1" aria-hidden="true"></i> 添加图片
                            </button>
                        </div>
                    </div>
                    <!-- 日记图片开关部分结束 -->
                    <div class="space-y-2 pt-2">
                        <label for="diaryContent" class="block text-sm font-medium text-neutral">日记内容</label>
                        <textarea id="diaryContent" name="diaryContent" rows="8"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth resize-none"
                            placeholder="今天天气很好..."></textarea>
                    </div>
                    
                    <div class="pt-2">
                        <button type="submit" class="generate-btn w-full bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-6 rounded-xl transition-smooth flex items-center justify-center" data-type="diary">
                            <i class="fa fa-book mr-2" aria-hidden="true"></i>生成日记文档
                        </button>
                    </div>
                </form>

                <!-- 相册表单 -->
                <form id="albumForm" class="form-content space-y-5 hidden">
                    <div class="space-y-2">
                        <label for="albumTitle" class="block text-sm font-medium text-neutral">相册标题 <span class="text-red-500">*</span></label>
                        <input type="text" id="albumTitle" name="albumTitle" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：我的旅行相册">
                    </div>
                    <div class="space-y-2">
                        <label for="albumId" class="block text-sm font-medium text-neutral">相册ID <span class="text-red-500">*</span></label>
                        <input type="text" id="albumId" name="albumId" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：my-travel-album (小写，用短横杠连接)">
                    </div>
                    <div class="space-y-2">
                        <label for="albumDate" class="block text-sm font-medium text-neutral">创建日期</label>
                        <input type="date" id="albumDate" name="albumDate"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                    </div>
                    <div class="space-y-2">
                        <label for="albumDescription" class="block text-sm font-medium text-neutral">相册描述</label>
                        <textarea id="albumDescription" name="albumDescription" rows="2"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth resize-none"
                            placeholder="描述这个相册的内容..."></textarea>
                    </div>
                    <div class="space-y-2">
                        <label for="albumLocation" class="block text-sm font-medium text-neutral">拍摄地点</label>
                        <input type="text" id="albumLocation" name="albumLocation"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：日本，东京">
                    </div>
                    <div class="space-y-2">
                        <label for="albumTags" class="block text-sm font-medium text-neutral">标签 (用逗号分隔)</label>
                        <input type="text" id="albumTags" name="albumTags"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：旅行，风景，日本">
                    </div>

                    <!-- 相册选项 -->
                    <div class="space-y-4 pt-2">
                        <!-- 是否隐藏 -->
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="albumHidden" name="albumHidden"
                                class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                            <label for="albumHidden" class="text-sm font-medium text-neutral">隐藏相册 (不会在相册列表显示)</label>
                        </div>

                        <!-- 相册类型 -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-neutral">相册类型</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="albumType" value="local" checked class="hidden">
                                    <span id="localTypeBtn" class="radio-btn-local px-4 py-2 rounded-lg border border-slate-300 bg-white text-slate-700 font-medium transition-smooth hover:bg-slate-50">
                                        本地图片
                                    </span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="albumType" value="external" class="hidden">
                                    <span id="externalTypeBtn" class="radio-btn-external px-4 py-2 rounded-lg border border-slate-300 bg-white text-slate-700 font-medium transition-smooth hover:bg-slate-50">
                                        外部图片
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- 相册布局 -->
                        <div class="space-y-2">
                            <label for="albumLayout" class="block text-sm font-medium text-neutral">布局方式</label>
                            <select id="albumLayout" name="albumLayout" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                                <option value="grid">网格布局</option>
                                <option value="masonry">瀑布流布局</option>
                            </select>
                        </div>

                        <!-- 列数 -->
                        <div class="space-y-2">
                            <label for="albumColumns" class="block text-sm font-medium text-neutral">列数</label>
                            <select id="albumColumns" name="albumColumns" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                                <option value="2">2列</option>
                                <option value="3" selected>3列</option>
                                <option value="4">4列</option>
                            </select>
                        </div>
                    </div>

                    <!-- 封面图片 -->
                    <div class="space-y-2 pt-2">
                        <label for="albumCover" class="block text-sm font-medium text-neutral">封面图片 <span class="text-red-500">*</span></label>
                        <input type="text" id="albumCover" name="albumCover" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="本地相册: 封面图片文件名 (如: cover.jpg); 外部相册: 完整URL (如: https://example.com/image.jpg)">
                    </div>

                    <!-- 图片列表 - 仅在外部相册模式下显示 -->
                    <div id="photosSection" class="space-y-2 pt-4 hidden">
                        <div class="flex justify-between items-center">
                            <label class="block text-sm font-medium text-neutral">相册图片列表</label>
                            <button type="button" id="addPhotoBtn" class="text-sm text-primary hover:text-primary/80 transition-smooth flex items-center">
                                <i class="fa fa-plus mr-1" aria-hidden="true"></i> 添加图片
                            </button>
                        </div>
                        <div id="photosContainer" class="space-y-3">
                            <!-- 图片输入框将动态添加到这里 -->
                        </div>
                    </div>

                    <div class="pt-4">
                        <button type="submit" class="generate-btn w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-6 rounded-xl transition-smooth flex items-center justify-center" data-type="album">
                            <i class="fa fa-picture-o mr-2" aria-hidden="true"></i>生成相册配置
                        </button>
                    </div>
                </form>
            </div>

            <div class="bg-white rounded-2xl p-6 card-shadow">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i class="fa fa-eye text-primary mr-2" aria-hidden="true"></i>预览结果
                </h2>
                <div class="relative">
                    <div id="resultContainer" class="bg-slate-50 rounded-xl p-5 font-mono text-sm overflow-auto max-h-[600px]">
                        <pre id="markdownResult" class="text-slate-700">---
title: "请选择选项卡并填写信息"
date: 2025-09-29
---

请在左侧填写文档信息并点击生成按钮...</pre>
                    </div>
                    <button id="copyButton" class="absolute top-4 right-4 bg-white/80 hover:bg-white text-primary p-2 rounded-lg shadow-md transition-smooth opacity-70 hover:opacity-100">
                        <i class="fa fa-copy" aria-hidden="true"></i>
                    </button>
                </div>
                <div id="copyMessage" class="hidden mt-3 text-sm text-center py-2 px-4 rounded-lg bg-secondary/10 text-secondary">
                    <i class="fa fa-check mr-1" aria-hidden="true"></i>已复制到剪贴板
                </div>
                <div class="mt-4">
                    <button id="downloadButton" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-medium py-3 px-6 rounded-xl transition-smooth flex items-center justify-center">
                        <i class="fa fa-download mr-2" aria-hidden="true"></i>下载Markdown文件
                    </button>
                </div>
                
                <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fa fa-exclamation-triangle text-yellow-400 text-lg" aria-hidden="true"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700">
                                <strong>当前为手动模式：</strong>生成文件后，您需要手动将文件放入对应的 <code class="bg-white px-1 rounded">src/content/</code> 目录，然后推送到 GitHub。
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-12 text-center text-neutral text-sm">
            <p>Firef、文档生成工具 &copy; 2025</p>
        </footer>
    </div>

    <script>
        let activeFormType = 'normal';
        let photoCount = 0; // 用于为图片输入框分配唯一ID

        // 获取当前日期并格式化为YYYY-MM-DD
        function getCurrentDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const currentDate = getCurrentDate();

            // 设置默认日期为当天
            document.getElementById('normalPublished').value = currentDate;
            document.getElementById('diaryDate').value = currentDate;
            document.getElementById('albumDate').value = currentDate;

            // 更新预览中的日期
            document.getElementById('markdownResult').textContent = `---
title: "请选择选项卡并填写信息"
date: ${currentDate}
---

请在左侧填写文档信息并点击生成按钮...`;

            const tabBtns = document.querySelectorAll('.tab-btn');
            const formContents = document.querySelectorAll('.form-content');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    tabBtns.forEach(b => b.classList.remove('tab-active'));
                    btn.classList.add('tab-active');
                    const target = btn.getAttribute('data-target');
                    formContents.forEach(form => form.classList.add('hidden'));
                    document.getElementById(target).classList.remove('hidden');
                    activeFormType = target.replace('Form', '');
                });
            });

            // 日记图片功能
            document.getElementById('addImageBtn').addEventListener('click', () => {
                const container = document.getElementById('diaryImagesContainer');
                const newDiv = document.createElement('div');
                newDiv.className = 'album-image-input';
                newDiv.innerHTML = `
                    <input type="text" name="diaryImage[]" 
                        class="flex-1 px-3 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary/50 outline-none transition-smooth text-sm"
                        placeholder="输入图片文件名或外部链接">
                    <button type="button" class="remove-image-btn text-red-500 hover:text-red-700 p-1">
                        <i class="fa fa-trash" aria-hidden="true"></i>
                    </button>
                `;
                container.appendChild(newDiv);

                // 添加删除事件
                newDiv.querySelector('.remove-image-btn').addEventListener('click', function() {
                    this.parentElement.remove();
                });
            });

            // 相册图片功能
            document.getElementById('addPhotoBtn').addEventListener('click', () => {
                const container = document.getElementById('photosContainer');
                const newDiv = document.createElement('div');
                newDiv.className = 'album-image-input';
                newDiv.innerHTML = `
                    <input type="text" name="photoSrc[]" 
                        class="flex-1 px-3 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary/50 outline-none transition-smooth text-sm"
                        placeholder="图片源地址">
                    <button type="button" class="remove-photo-btn text-red-500 hover:text-red-700 p-1">
                        <i class="fa fa-trash" aria-hidden="true"></i>
                    </button>
                `;
                container.appendChild(newDiv);
                
                // 添加删除事件
                newDiv.querySelector('.remove-photo-btn').addEventListener('click', function() {
                    this.parentElement.remove();
                });
            });

            // 监听日记图片开关
            document.getElementById('diaryUseImage').addEventListener('change', function() {
                const section = document.getElementById('diaryImageSection');
                section.classList.toggle('hidden', !this.checked);
            });

            // 相册类型切换
            document.querySelectorAll('input[name="albumType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'external') {
                        document.getElementById('photosSection').classList.remove('hidden');
                    } else {
                        document.getElementById('photosSection').classList.add('hidden');
                    }
                });
            });

            // 绑定相册类型按钮点击事件
            document.getElementById('localTypeBtn').addEventListener('click', function() {
                document.querySelector('input[name="albumType"][value="local"]').checked = true;
                document.getElementById('photosSection').classList.add('hidden');
            });
            
            document.getElementById('externalTypeBtn').addEventListener('click', function() {
                document.querySelector('input[name="albumType"][value="external"]').checked = true;
                document.getElementById('photosSection').classList.remove('hidden');
            });

            // 监听各个图片开关
            document.getElementById('normalUseImage').addEventListener('change', function() {
                const section = document.getElementById('normalImageSection');
                section.classList.toggle('hidden', !this.checked);
            });

            document.getElementById('normalUsePassword').addEventListener('change', function() {
                const section = document.getElementById('normalPasswordSection');
                section.classList.toggle('hidden', !this.checked);
            });
            
            // 普通表单提交事件
            document.getElementById('normalForm').addEventListener('submit', function(e) {
                e.preventDefault();
                generateMarkdown('normal');
            });
            
            document.getElementById('diaryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                generateMarkdown('diary');
            });
            
            document.getElementById('albumForm').addEventListener('submit', function(e) {
                e.preventDefault();
                generateMarkdown('album');
            });
            
            // 复制按钮功能
            document.getElementById('copyButton').addEventListener('click', function() {
                const resultText = document.getElementById('markdownResult').textContent;
                navigator.clipboard.writeText(resultText).then(() => {
                    const msg = document.getElementById('copyMessage');
                    msg.classList.remove('hidden');
                    setTimeout(() => msg.classList.add('hidden'), 2000);
                });
            });
            
            // 下载按钮功能
            document.getElementById('downloadButton').addEventListener('click', function() {
                const resultText = document.getElementById('markdownResult').textContent;
                const blob = new Blob([resultText], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = getFileName(activeFormType) + '.md';
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 0);
            });
        });

        // 生成文件名
        function getFileName(type) {
            let title, date;
            switch(type) {
                case 'normal':
                    title = document.getElementById('normalTitle').value || 'untitled';
                    date = document.getElementById('normalPublished').value || getCurrentDate();
                    break;
                case 'diary':
                    title = document.getElementById('diaryTitle').value || 'diary-entry';
                    date = document.getElementById('diaryDate').value || getCurrentDate();
                    break;
                case 'album':
                    title = document.getElementById('albumTitle').value || 'album';
                    date = document.getElementById('albumDate').value || getCurrentDate();
                    break;
            }
            // 清理标题以适合作为文件名
            title = title.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]+/g, '-').replace(/^-+|-+$/g, '');
            return `${date}-${title}`;
        }

        // 生成Markdown函数
        function generateMarkdown(type) {
            let title, date, description, tags, category, content, extraFields = {};
            
            switch(type) {
                case 'normal': // 帖子
                    title = document.getElementById('normalTitle').value;
                    date = document.getElementById('normalPublished').value || getCurrentDate();
                    description = document.getElementById('normalDescription').value;
                    tags = document.getElementById('normalTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                    category = document.getElementById('normalCategory').value;
                    content = document.getElementById('normalContent').value;
                    
                    // 处理额外字段
                    extraFields.image = document.getElementById('normalUseImage').checked ? 
                        document.getElementById('normalImage').value : undefined;
                    extraFields.draft = document.getElementById('normalDraft').checked;
                    extraFields.pinned = document.getElementById('normalPinned').checked;
                    if(document.getElementById('normalUsePassword').checked) {
                        extraFields.password = document.getElementById('normalPassword').value;
                    }
                    break;
                    
                case 'diary': // 日记
                    title = document.getElementById('diaryTitle').value;
                    date = document.getElementById('diaryDate').value || getCurrentDate();
                    description = document.getElementById('diaryDescription')?.value || "";
                    tags = (document.getElementById('diaryTags')?.value || "").split(',').map(tag => tag.trim()).filter(tag => tag);
                    content = document.getElementById('diaryContent').value;
                    
                    // 处理图片
                    if(document.getElementById('diaryUseImage').checked) {
                        const imageInputs = document.querySelectorAll('#diaryImagesContainer input[name="diaryImage[]"]');
                        extraFields.images = Array.from(imageInputs).map(input => input.value).filter(val => val);
                    }
                    break;
                    
                case 'album': // 相册
                    title = document.getElementById('albumTitle').value;
                    const albumId = document.getElementById('albumId').value;
                    date = document.getElementById('albumDate').value || getCurrentDate();
                    description = document.getElementById('albumDescription').value;
                    const location = document.getElementById('albumLocation').value;
                    tags = document.getElementById('albumTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                    const layout = document.getElementById('albumLayout').value;
                    const columns = parseInt(document.getElementById('albumColumns').value);
                    const cover = document.getElementById('albumCover').value;
                    const hidden = document.getElementById('albumHidden').checked;
                    const mode = document.querySelector('input[name="albumType"]:checked').value;
                    
                    // 处理相册中的照片
                    let photos = [];
                    if(mode === 'external') {
                        const photoInputs = document.querySelectorAll('#photosContainer input[name="photoSrc[]"]');
                        photos = Array.from(photoInputs).map(input => ({
                            src: input.value,
                            alt: "Photo"
                        })).filter(photo => photo.src);
                    }
                    
                    // 创建内容
                    content = `# ${title}\n\n${description || '这是一个相册页面'}`;
                    
                    // 返回相册格式的数据
                    const albumData = {
                        title,
                        id: albumId,
                        date,
                        description: description || "",
                        location: location || "",
                        tags: tags.length ? tags : [],
                        layout: layout || "grid",
                        columns: columns || 3,
                        cover,
                        hidden: hidden || false,
                        mode: mode || "local",
                        photos
                    };
                    
                    // 生成相册的Markdown内容
                    const albumFrontmatter = `---
title: "${albumData.title}"
id: "${albumData.id}"
date: ${albumData.date}
description: "${albumData.description}"
location: "${albumData.location}"
tags: [${albumData.tags.map(tag => `"${tag}"`).join(', ')}]
layout: "${albumData.layout}"
columns: ${albumData.columns}
cover: "${albumData.cover}"
hidden: ${albumData.hidden}
mode: "${albumData.mode}"
${albumData.photos.length > 0 ? `photos:\n${albumData.photos.map(photo => `  - src: "${photo.src}"\n    alt: "${photo.alt}"`).join('\n')}` : ''}
---

${content}`;
                    
                    document.getElementById('markdownResult').textContent = albumFrontmatter;
                    return; // 提前返回，因为我们已经设置了结果
            }
            
            // 构建Frontmatter
            let frontmatter = `---\ntitle: "${title}"\ndate: ${date}`;
            if(description) frontmatter += `\ndescription: "${description}"`;
            if(category) frontmatter += `\ncategory: "${category}"`;
            if(tags.length > 0) frontmatter += `\ntags: [${tags.map(tag => `"${tag}"`).join(', ')}]`;
            
            // 添加额外字段
            Object.entries(extraFields).forEach(([key, value]) => {
                if(value !== undefined) {
                    if(typeof value === 'string') {
                        frontmatter += `\n${key}: "${value}"`;
                    } else if(typeof value === 'boolean' || typeof value === 'number') {
                        frontmatter += `\n${key}: ${value}`;
                    } else if(Array.isArray(value)) {
                        frontmatter += `\n${key}: [${value.map(v => `"${v}"`).join(', ')}]`;
                    } else if(typeof value === 'object') {
                        // 处理复杂对象
                        frontmatter += `\n${key}: ${JSON.stringify(value, null, 2).split('\n').join('\n  ')}`;
                    }
                }
            });
            
            frontmatter += '\n---\n\n';
            
            // 最终内容 = Frontmatter + 内容
            const fullContent = frontmatter + content;
            
            // 显示在结果区域
            document.getElementById('markdownResult').textContent = fullContent;
        }

        // 暴露函数给全局作用域以便外部调用
        window.getCurrentDate = getCurrentDate;
        window.generateMarkdown = generateMarkdown;
    </script>
</body>
</html>