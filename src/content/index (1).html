<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firef CMS - 内容管理器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        },
                        secondary: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        },
                        accent: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        neutral: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        },
                        surface: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 10px 25px -5px rgba(79, 70, 229, 0.05), 0 8px 10px -6px rgba(79, 70, 229, 0.02)',
                        'card-hover': '0 20px 25px -5px rgba(79, 70, 229, 0.1), 0 10px 10px -6px rgba(79, 70, 229, 0.05)',
                        'btn': '0 4px 6px -1px rgba(79, 70, 229, 0.1), 0 2px 4px -1px rgba(79, 70, 229, 0.06)',
                        'btn-hover': '0 6px 12px -2px rgba(79, 70, 229, 0.15), 0 4px 8px -2px rgba(79, 70, 229, 0.1)',
                        'input': '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'input-focus': '0 1px 2px 0 rgba(0, 0, 0, 0.05), 0 0 0 3px rgba(99, 102, 241, 0.2)',
                        'modal': '0 25px 50px -12px rgba(79, 70, 229, 0.25)',
                    },
                    borderRadius: {
                        'card': '1.25rem',
                        'button': '0.75rem',
                        'input': '0.625rem',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            body {
                font-family: 'Inter', system-ui, sans-serif;
                background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            }
        }
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: var(--tw-shadow, 0 0 #0000);
            }
            .transition-smooth {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            .tab-active {
                color: #4f46e5;
                font-weight: 600;
                position: relative;
            }
            .tab-active::after {
                content: '';
                position: absolute;
                bottom: -1px;
                left: 0;
                width: 100%;
                height: 3px;
                background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
                border-radius: 2px;
            }

            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .album-image-input {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
                padding: 0.75rem;
                background: #f8fafc;
                border: 1px solid #e2e8f0;
                border-radius: 0.625rem;
                transition: all 0.2s ease-in-out;
            }

            .album-image-input:hover {
                border-color: #c7d2fe;
                background: #f1f5f9;
            }

            /* 模态框样式 */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(79, 70, 229, 0.3) 0%, rgba(99, 102, 241, 0.2) 100%);
                z-index: 1000;
                justify-content: center;
                align-items: center;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .modal.active {
                display: flex;
                opacity: 1;
                visibility: visible;
            }
            .modal-content {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                padding: 2rem;
                border-radius: 1.25rem;
                width: 90%;
                max-width: 28rem;
                box-shadow: var(--tw-shadow);
                position: relative;
                transform: scale(0.95);
                opacity: 0;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .modal.active .modal-content {
                transform: scale(1);
                opacity: 1;
            }
            .modal-header {
                margin-bottom: 1rem;
                text-align: center;
            }
            .modal-title {
                font-size: 1.25rem;
                font-weight: 600;
                color: #1e293b;
                background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            .modal-body {
                margin-bottom: 1.5rem;
            }
            .modal-input {
                width: 100%;
                padding: 0.75rem;
                border: 1px solid #e2e8f0;
                border-radius: 0.625rem;
                font-size: 1rem;
                margin-top: 0.5rem;
                transition: all 0.2s ease-in-out;
                background: white;
            }
            .modal-input:focus {
                outline: none;
                border-color: #4f46e5;
                box-shadow: var(--tw-shadow);
            }
            .modal-footer {
                display: flex;
                gap: 0.75rem;
                justify-content: center;
            }
            .btn {
                padding: 0.625rem 1.25rem;
                border-radius: 0.75rem;
                font-weight: 500;
                cursor: pointer;
                border: none;
                transition: all 0.2s ease-in-out;
                font-size: 0.95rem;
            }
            .btn-primary {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                color: white;
                box-shadow: var(--tw-shadow);
            }
            .btn-primary:hover {
                background: linear-gradient(135deg, #4338ca 0%, #6d28d9 100%);
                transform: translateY(-2px);
                box-shadow: var(--tw-shadow);
            }
            .btn-secondary {
                background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
                color: #475569;
            }
            .btn-secondary:hover {
                background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
                transform: translateY(-1px);
            }
            .loading-spinner {
                display: inline-block;
                width: 1rem;
                height: 1rem;
                border: 2px solid #f3f4f6;
                border-radius: 50%;
                border-top-color: #4f46e5;
                animation: spin 1s linear infinite;
                margin-right: 0.5rem;
            }
            @keyframes spin {
                to { transform: rotate(360deg); }
            }

            /* 表单切换动画 */
            .form-content {
                transition: all 0.3s ease-in-out;
            }

            /* 选项卡切换动画 */
            .tab-btn {
                position: relative;
                transition: all 0.2s ease-in-out;
                padding: 0.75rem 1.5rem;
                border-radius: 0.75rem;
            }
            .tab-btn:hover {
                background: #f1f5f9;
            }
            .tab-btn::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 0;
                height: 2px;
                background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
                transition: width 0.3s ease-in-out;
            }
            .tab-btn:not(.tab-active):hover::after {
                width: 100%;
            }
            .tab-btn.tab-active::after {
                width: 100%;
            }

            /* 输入框焦点动画 */
            input, textarea {
                transition: all 0.2s ease-in-out;
                border: 1px solid #e2e8f0;
                border-radius: 0.625rem;
            }
            input:focus, textarea:focus {
                outline: none;
                border-color: #c7d2fe;
                box-shadow: var(--tw-shadow);
            }

            /* 按钮悬停动画 */
            .generate-btn {
                transition: all 0.2s ease-in-out;
                padding: 0.75rem 1.5rem;
                border-radius: 0.75rem;
                font-weight: 500;
                font-size: 1rem;
            }
            .generate-btn:hover {
                transform: translateY(-3px);
                box-shadow: var(--tw-shadow);
            }

            /* 卡片悬停动画 */
            .card-shadow {
                transition: all 0.3s ease-in-out;
                border-radius: 1.25rem;
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            }
            .card-shadow:hover {
                transform: translateY(-5px);
                box-shadow: var(--tw-shadow);
            }

            /* 自定义复选框样式 */
            input[type="checkbox"].custom-checkbox {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                width: 1.25rem;
                height: 1.25rem;
                border: 2px solid #cbd5e1;
                border-radius: 0.25rem;
                position: relative;
                cursor: pointer;
                background-color: white;
                transition: all 0.3s ease;
            }

            input[type="checkbox"].custom-checkbox:hover {
                border-color: #4f46e5;
                box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
            }

            input[type="checkbox"].custom-checkbox:checked {
                background-color: #4f46e5;
                border-color: #4f46e5;
            }

            input[type="checkbox"].custom-checkbox:checked::after {
                content: '';
                position: absolute;
                left: 5px;
                top: 2px;
                width: 5px;
                height: 10px;
                border: solid white;
                border-width: 0 2px 2px 0;
                transform: rotate(45deg);
            }

            input[type="checkbox"].custom-checkbox:active {
                transform: scale(0.95);
            }
            @keyframes checkboxChecked {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }

            /* 单选按钮动画 */
            input[type="radio"] {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                width: 1.25rem;
                height: 1.25rem;
                cursor: pointer;
                box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.03);
            }
            input[type="radio"]:hover {
                box-shadow: inset 0 1px 2px 0 rgba(79, 70, 229, 0.2), 0 0 0 2px rgba(79, 70, 229, 0.2);
            }
            input[type="radio"]::before {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                border-radius: 50%;
                background: transparent;
                transform: translate(-50%, -50%);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            input[type="radio"]:checked {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                border-color: #4f46e5;
                animation: radioChecked 0.3s ease-out;
            }
            input[type="radio"]:checked::before {
                width: 0.625rem;
                height: 0.625rem;
                background: white;
            }
            input[type="radio"]:active {
                transform: scale(0.95);
            }
            @keyframes radioChecked {
                0% { transform: scale(1); }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); }
            }

            /* 显示/隐藏动画 */
            .fade-in {
                animation: fadeInAnimation 0.3s ease-in-out;
            }
            @keyframes fadeInAnimation {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* 淡入淡出动画 */
            .fade-out {
                animation: fadeOutAnimation 0.3s ease-in-out;
            }
            @keyframes fadeOutAnimation {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(10px);
                }
            }

            /* 渐变背景 */
            .bg-gradient-card {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            }

            /* 按钮渐变 */
            .btn-gradient {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                color: white;
                border: none;
                box-shadow: var(--tw-shadow);
            }

            @keyframes spin-slow {
                from {
                    transform: rotate(0deg);
                }
                to {
                    transform: rotate(360deg);
                }
            }

            .animate-spin-slow {
                animation: spin-slow 3s linear infinite;
            }

            @keyframes pulse-slow {
                0%, 100% {
                    transform: scale(1);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.2);
                    opacity: 0.8;
                }
            }

            .animate-pulse-slow {
                animation: pulse-slow 2s ease-in-out infinite;
            }

            /* 确保渐变文字在所有浏览器中正常工作 */
            .text-gradient {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                color: transparent;
            }

            .text-gradient-animated {
                background: linear-gradient(45deg, #4f46e5, #7c3aed, #0ea5e9, #10b981, #4f46e5);
                background-size: 300% 300%;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                color: transparent;
                animation: gradientShift 6s ease infinite;
            }

            @keyframes gradientShift {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
        }
    </style>
</head>
<body class="min-h-screen font-sans text-[#1e293b]">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="text-center mb-12 cursor-default">
            <div class="inline-block">
                <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold mb-3 tracking-tight text-gradient-animated inline-flex items-center">
                    <i class="fa fa-file-text-o mr-3" aria-hidden="true"></i>Firef CMS - 内容管理器
                </h1>
                <div class="h-0.5 w-full bg-gradient-to-r from-transparent via-[#10b981] to-transparent rounded-full opacity-60 animate-pulse"></div>
            </div>
            <p class="text-[#64748b] text-lg max-w-2xl mx-auto font-medium mt-6">快速创建博客内容，支持帖子、日记和相册</p>
            <div class="flex justify-center mt-6 space-x-2.5">
                <div class="w-3 h-3 bg-gradient-to-r from-[#4f46e5] to-[#7c3aed] rounded-full animate-bounce hover:animate-ping cursor-pointer" style="animation-delay: 0s; animation-duration: 1s;"></div>
                <div class="w-3 h-3 bg-gradient-to-r from-[#10b981] to-[#059669] rounded-full animate-bounce hover:animate-ping cursor-pointer" style="animation-delay: 0.15s; animation-duration: 1s;"></div>
                <div class="w-3 h-3 bg-gradient-to-r from-[#0ea5e9] to-[#0284c7] rounded-full animate-bounce hover:animate-ping cursor-pointer" style="animation-delay: 0.3s; animation-duration: 1s;"></div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="rounded-[1.25rem] p-6 card-shadow bg-gradient-card transform hover:scale-[1.01] transition-smooth">
                <div class="flex border-b border-[#e2e8f0] mb-6 pb-1">
                    <button id="normalTab" class="tab-btn py-3 px-6 text-left transition-smooth tab-active" data-target="normalForm">
                        <i class="fa fa-file-text mr-2 text-[#4f46e5]" aria-hidden="true"></i>帖子文档
                    </button>
                    <button id="diaryTab" class="tab-btn py-3 px-6 text-left text-[#64748b] transition-smooth" data-target="diaryForm">
                        <i class="fa fa-book mr-2 text-[#10b981]" aria-hidden="true"></i>日记文档
                    </button>
                    <button id="albumTab" class="tab-btn py-3 px-6 text-left text-[#64748b] transition-smooth" data-target="albumForm">
                        <i class="fa fa-picture-o mr-2 text-[#0ea5e9]" aria-hidden="true"></i>相册配置
                    </button>
                </div>

                <!-- 帖子表单 -->
                <form id="normalForm" class="form-content space-y-5">
                    <div class="space-y-2">
                        <label for="normalTitle" class="block text-sm font-medium text-[#475569]">标题 <span class="text-red-500">*</span></label>
                        <input type="text" id="normalTitle" name="normalTitle" required
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth"
                            placeholder="例如：我的中文帖子">
                    </div>
                    <div class="space-y-2">
                        <label for="normalPublished" class="block text-sm font-medium text-[#475569]">发布日期</label>
                        <input type="date" id="normalPublished" name="normalPublished"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                    </div>
                    <div class="space-y-2">
                        <label for="normalDescription" class="block text-sm font-medium text-[#475569]">描述</label>
                        <textarea id="normalDescription" name="normalDescription" rows="2"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth resize-none"
                            placeholder="添加文档描述信息"></textarea>
                    </div>
                    <div class="space-y-2">
                        <label for="normalTags" class="block text-sm font-medium text-[#475569]">标签 (用逗号分隔)</label>
                        <input type="text" id="normalTags" name="normalTags"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth"
                            placeholder="例如：诗歌，测试">
                    </div>
                    <div class="space-y-2">
                        <label for="normalCategory" class="block text-sm font-medium text-[#475569]">分类</label>
                        <input type="text" id="normalCategory" name="normalCategory"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth"
                            placeholder="例如：创作">
                    </div>

                    <div class="space-y-4 pt-2">
                        <div>
                            <div class="flex items-center space-x-3 mb-3">
                                <input type="checkbox" id="normalUseImage" name="normalUseImage"
                                    class="custom-checkbox">
                                <label for="normalUseImage" class="text-sm font-medium text-[#475569]">添加封面图片</label>
                            </div>
                            <div id="normalImageSection" class="hidden pl-7 space-y-2 fade-in">
                                <label for="normalImage" class="block text-sm font-medium text-[#475569]">图片文件名（含后缀）</label>
                                <input type="text" id="normalImage" name="normalImage"
                                    class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth"
                                    placeholder="例如：online.jpg">
                            </div>
                        </div>

                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="normalDraft" name="normalDraft"
                                class="custom-checkbox">
                            <label for="normalDraft" class="text-sm font-medium text-[#475569]">设为草稿</label>
                        </div>

                        <div>
                            <div class="flex items-center space-x-3 mb-3">
                                <input type="checkbox" id="normalUsePassword" name="normalUsePassword"
                                    class="custom-checkbox">
                                <label for="normalUsePassword" class="text-sm font-medium text-[#475569]">设置密码保护</label>
                            </div>
                            <div id="normalPasswordSection" class="hidden pl-7 space-y-2 fade-in">
                                <label for="normalPassword" class="block text-sm font-medium text-[#475569]">密码</label>
                                <input type="text" id="normalPassword" name="normalPassword" value="666999"
                                    class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                            </div>
                        </div>

                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="normalPinned" name="normalPinned"
                                class="custom-checkbox">
                            <label for="normalPinned" class="text-sm font-medium text-[#475569]">置顶帖子</label>
                        </div>
                    </div>

                    <div class="space-y-2 pt-3">
                        <label for="normalContent" class="block text-sm font-medium text-[#475569]">正文内容</label>
                        <textarea id="normalContent" name="normalContent" rows="6"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth resize-none"
                            placeholder="请输入文档正文内容..."></textarea>
                    </div>

                    <div class="pt-4">
                        <button type="button" id="normalSubmitButton" class="generate-btn w-full btn-gradient text-white font-medium py-3 px-6 rounded-[0.75rem] transition-smooth flex items-center justify-center" data-type="normal">
                            <i class="fa fa-magic mr-2" aria-hidden="true"></i>生成帖子文档
                        </button>
                    </div>
                </form>

                <!-- 日记表单 -->
                <form id="diaryForm" class="form-content space-y-5 hidden">
                    <div class="space-y-2">
                        <label for="diaryTitle" class="block text-sm font-medium text-[#475569]">日记标题 <span class="text-red-500">*</span></label>
                        <input type="text" id="diaryTitle" name="diaryTitle" required
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth"
                            placeholder="例如：我的中文日记">
                    </div>
                    <div class="space-y-2">
                        <label for="diaryDate" class="block text-sm font-medium text-[#475569]">日记日期</label>
                        <input type="date" id="diaryDate" name="diaryDate"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                    </div>
                    <div class="pt-2">
                        <div class="flex items-center space-x-3 mb-3">
                            <input type="checkbox" id="diaryUseImage" name="diaryUseImage"
                                class="custom-checkbox">
                            <label for="diaryUseImage" class="text-sm font-medium text-[#475569]">添加图片</label>
                        </div>
                        <div id="diaryImageSection" class="hidden pl-7 space-y-3 fade-in">
                            <label class="block text-sm font-medium text-[#475569]">图片文件名或外部链接</label>
                            <div id="diaryImagesContainer" class="space-y-2">
                            </div>
                            <button type="button" id="addImageBtn" class="text-sm text-[#10b981] hover:text-[#059669] transition-smooth flex items-center">
                                <i class="fa fa-plus mr-1" aria-hidden="true"></i> 添加图片
                            </button>
                        </div>
                    </div>
                    <div class="space-y-2 pt-2">
                        <label for="diaryContent" class="block text-sm font-medium text-[#475569]">日记内容</label>
                        <textarea id="diaryContent" name="diaryContent" rows="8"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth resize-none"
                            placeholder="今天天气很好..."></textarea>
                    </div>

                    <div class="pt-2">
                        <button type="button" id="diarySubmitButton" class="generate-btn w-full bg-gradient-to-r from-[#10b981] to-[#059669] text-white font-medium py-3 px-6 rounded-[0.75rem] transition-smooth flex items-center justify-center" data-type="diary">
                            <i class="fa fa-book mr-2" aria-hidden="true"></i>生成日记文档
                        </button>
                    </div>
                </form>

                <!-- 相册表单 -->
                <form id="albumForm" class="form-content space-y-5 hidden">
                    <div class="space-y-2">
                        <label for="albumTitle" class="block text-sm font-medium text-[#475569]">相册标题 <span class="text-red-500">*</span></label>
                        <input type="text" id="albumTitle" name="albumTitle" required
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth"
                            placeholder="例如：我的旅行相册">
                    </div>
                    <div class="space-y-2">
                        <label for="albumId" class="block text-sm font-medium text-[#475569]">相册ID <span class="text-red-500">*</span></label>
                        <input type="text" id="albumId" name="albumId" required
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth"
                            placeholder="例如：my-travel-album (小写，用短横杠连接)">
                    </div>
                    <div class="space-y-2">
                        <label for="albumDate" class="block text-sm font-medium text-[#475569]">创建日期</label>
                        <input type="date" id="albumDate" name="albumDate"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                    </div>
                    <div class="space-y-2">
                        <label for="albumDescription" class="block text-sm font-medium text-[#475569]">相册描述</label>
                        <textarea id="albumDescription" name="albumDescription" rows="2"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth resize-none"
                            placeholder="描述这个相册的内容..."></textarea>
                    </div>
                    <div class="space-y-2">
                        <label for="albumLocation" class="block text-sm font-medium text-[#475569]">拍摄地点</label>
                        <input type="text" id="albumLocation" name="albumLocation"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth"
                            placeholder="例如：日本，东京">
                    </div>
                    <div class="space-y-2">
                        <label for="albumTags" class="block text-sm font-medium text-[#475569]">标签 (用逗号分隔)</label>
                        <input type="text" id="albumTags" name="albumTags"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth"
                            placeholder="例如：旅行，风景，日本">
                    </div>

                    <div class="space-y-4 pt-2">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="albumHidden" name="albumHidden"
                                class="custom-checkbox">
                            <label for="albumHidden" class="text-sm font-medium text-[#475569]">隐藏相册</label>
                        </div>
                    </div>

                    <div class="pt-3">
                        <label class="block text-sm font-medium text-[#475569] mb-3">相册类型</label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="flex items-center space-x-3 p-4 border border-[#e2e8f0] rounded-[0.75rem] cursor-pointer hover:bg-[#f1f5f9] transition-smooth">
                                <input type="radio" name="albumType" value="local" checked
                                    class="w-4 h-4 text-[#0ea5e9] border-[#cbd5e1] focus:ring-[#0ea5e9]">
                                <div>
                                    <div class="font-medium text-[#475569]">本地相册</div>
                                    <div class="text-xs text-[#94a3b8]">上传图片到本地图库</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-4 border border-[#e2e8f0] rounded-[0.75rem] cursor-pointer hover:bg-[#f1f5f9] transition-smooth">
                                <input type="radio" name="albumType" value="external"
                                    class="w-4 h-4 text-[#0ea5e9] border-[#cbd5e1] focus:ring-[#0ea5e9]">
                                <div>
                                    <div class="font-medium text-[#475569]">外部相册</div>
                                    <div class="text-xs text-[#94a3b8]">使用外部图片链接</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="pt-3 space-y-4">
                        <div class="space-y-2">
                            <label for="albumLayout" class="block text-sm font-medium text-[#475569]">布局方式</label>
                            <select id="albumLayout" class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                                <option value="grid">网格布局</option>
                                <option value="masonry">瀑布流布局</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label for="albumColumns" class="block text-sm font-medium text-[#475569]">列数</label>
                            <input type="number" id="albumColumns" min="1" max="6" value="3"
                                class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                        </div>
                        <div class="space-y-2">
                            <label for="albumCover" class="block text-sm font-medium text-[#475569]">封面图片</label>
                            <input type="text" id="albumCover" placeholder="相册封面图片路径"
                                class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                        </div>
                    </div>

                    <div id="externalAlbumSection" class="hidden space-y-3 pt-4">
                        <label class="block text-sm font-medium text-[#475569]">相册图片 <small class="text-[#94a3b8]">(外部链接)</small></label>
                        <div id="photosContainer" class="space-y-2">
                        </div>
                        <button type="button" id="addPhotoBtn" class="text-sm text-[#0ea5e9] hover:text-[#0284c7] transition-smooth flex items-center">
                            <i class="fa fa-plus mr-1" aria-hidden="true"></i> 添加图片
                        </button>
                    </div>

                    <div class="pt-4">
                        <button type="button" id="albumSubmitButton" class="generate-btn w-full bg-gradient-to-r from-[#0ea5e9] to-[#0369a1] text-white font-medium py-3 px-6 rounded-[0.75rem] transition-smooth flex items-center justify-center" data-type="album">
                            <i class="fa fa-picture-o mr-2" aria-hidden="true"></i>生成相册文档
                        </button>
                    </div>
                </form>
            </div>

            <!-- 结果和控制面板 -->
            <div class="rounded-[1.25rem] p-6 card-shadow bg-gradient-card">
                <div class="border-b border-[#e2e8f0] pb-4 mb-6">
                    <h2 class="text-xl font-semibold text-[#1e293b] flex items-center">
                        <i class="fa fa-code mr-2 text-[#4f46e5]" aria-hidden="true"></i>生成结果
                    </h2>
                    <p class="text-sm text-[#64748b] mt-1">生成的Frontmatter文档格式，可直接用于博客</p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label for="fileName" class="block text-sm font-medium text-[#475569] mb-2">文件名</label>
                        <input type="text" id="fileName" placeholder="例如：2025-01-01-my-post.md"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                        <p class="text-xs text-[#94a3b8] mt-1">请包含正确的文件扩展名(.md)和日期前缀</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-[#475569] mb-2">文件路径</label>
                        <div class="flex space-x-2">
                            <select id="fileDirectory" class="flex-1 px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                                <option value="src/content/posts">文章 (src/content/posts)</option>
                                <option value="src/content/diary">日记 (src/content/diary)</option>
                                <option value="src/content/albums">相册 (src/content/albums)</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-[#475569] mb-2 flex justify-between items-center">
                            <span>生成的内容</span>
                            <button id="copyButton" class="text-sm bg-[#f1f5f9] hover:bg-[#e2e8f0] text-[#475569] px-3 py-1 rounded-[0.5rem] transition-smooth flex items-center">
                                <i class="fa fa-copy mr-1" aria-hidden="true"></i>复制
                            </button>
                        </label>
                        <pre id="markdownResult" class="bg-[#f8fafc] border border-[#e2e8f0] rounded-[0.625rem] p-4 text-sm font-mono whitespace-pre-wrap overflow-x-auto max-h-96 overflow-y-auto"></pre>
                    </div>

                    <div class="pt-4">
                        <button id="saveToGithub" class="w-full bg-gradient-to-r from-[#10b981] to-[#059669] text-white font-medium py-3 px-6 rounded-[0.75rem] transition-smooth flex items-center justify-center">
                            <i class="fa fa-github mr-2" aria-hidden="true"></i>提交到 GitHub 仓库
                        </button>
                        <div class="flex items-center justify-center mt-2 space-x-4">
                            <p class="text-xs text-[#94a3b8] flex items-center"><i class="fas fa-circle text-red-500 mr-1 text-[6px]"></i>未认证</p>
                            <p class="text-xs text-[#94a3b8] flex items-center"><i class="fas fa-circle text-green-500 mr-1 text-[6px]"></i>已认证</p>
                        </div>
                        <p class="text-xs text-[#94a3b8] mt-1 text-center">需通过 GitHub Access Token 认证</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 密钥输入模态框 -->
    <div id="tokenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">请输入GitHub密钥</h3>
            </div>
            <div class="modal-body">
                <label for="tokenInput" class="block text-sm font-medium text-neutral mb-2">Personal Access Token</label>
                <input type="password" id="tokenInput" class="modal-input" placeholder="输入您的GitHub Personal Access Token">
                <div class="flex items-center mt-3">
                    <input type="checkbox" id="saveTokenCheckbox" class="custom-checkbox">
                    <label for="saveTokenCheckbox" class="ml-2 text-sm text-neutral">保存密钥到浏览器</label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelTokenBtn" class="btn btn-secondary">取消</button>
                <button id="submitTokenBtn" class="btn btn-primary">提交</button>
            </div>
        </div>
    </div>

    <!-- 提交反馈模态框 -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-body flex items-center">
                <span id="loadingSpinner" class="loading-spinner"></span>
                <span id="feedbackText">正在提交到GitHub...</span>
            </div>
        </div>
    </div>

    <!-- 成功提示模态框 -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="flex justify-center mb-4">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-r from-[#10b981] to-[#059669] flex items-center justify-center">
                        <i class="fa fa-check text-white text-2xl" aria-hidden="true"></i>
                    </div>
                </div>
                <p id="successText" class="text-lg font-medium text-[#1e293b]">操作成功完成！</p>
            </div>
        </div>
    </div>

    <script>
        // 选项卡切换功能
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                // 移除所有活动状态
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.add('text-neutral');
                    btn.classList.remove('tab-active');
                });

                // 添加活动状态到当前按钮
                button.classList.add('tab-active');
                button.classList.remove('text-neutral');

                // 获取目标表单
                const target = button.getAttribute('data-target');
                const targetForm = document.getElementById(target);

                // 获取当前显示的表单
                const currentForm = document.querySelector('.form-content:not(.hidden):not(.fade-out)');

                // 如果有当前表单正在显示，则先淡出
                if (currentForm && currentForm !== targetForm) {
                    currentForm.classList.add('fade-out');
                    setTimeout(() => {
                        currentForm.classList.add('hidden');
                        currentForm.classList.remove('fade-out');

                        // 然后淡入目标表单
                        targetForm.classList.remove('hidden');
                        setTimeout(() => {
                            targetForm.classList.add('fade-in');

                            // 隐藏完成后生成Markdown
                            setTimeout(() => {
                                const formType = target.replace('Form', '');
                                generateMarkdown(formType);
                            }, 300);
                        }, 1);
                    }, 300);
                } else {
                    // 如果没有当前表单（首次加载）或点击的是当前表单，直接显示目标表单
                    document.querySelectorAll('.form-content').forEach(form => {
                        if (form !== targetForm) {
                            form.classList.add('hidden');
                        }
                    });
                    targetForm.classList.remove('hidden');
                    targetForm.classList.add('fade-in');

                    const formType = target.replace('Form', '');
                    generateMarkdown(formType);

                    // 添加完成后移除fade-in类，以防止重复动画
                    setTimeout(() => {
                        if (targetForm.classList.contains('fade-in')) {
                            targetForm.classList.remove('fade-in');
                        }
                    }, 300);
                }
            });
        });

        // 图片开关功能
        document.getElementById('normalUseImage').addEventListener('change', function() {
            const section = document.getElementById('normalImageSection');
            if(this.checked) {
                section.classList.remove('hidden');
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 1);
            } else {
                section.classList.add('fade-out');
                setTimeout(() => {
                    section.classList.add('hidden');
                    section.classList.remove('fade-out');
                }, 300);
            }
        });

        document.getElementById('normalUsePassword').addEventListener('change', function() {
            const section = document.getElementById('normalPasswordSection');
            if(this.checked) {
                section.classList.remove('hidden');
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 1);
            } else {
                section.classList.add('fade-out');
                setTimeout(() => {
                    section.classList.add('hidden');
                    section.classList.remove('fade-out');
                }, 300);
            }
        });

        // 日记图片功能
        document.getElementById('diaryUseImage').addEventListener('change', function() {
            const section = document.getElementById('diaryImageSection');
            if(this.checked) {
                section.classList.remove('hidden');
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 1);
            } else {
                section.classList.add('fade-out');
                setTimeout(() => {
                    section.classList.add('hidden');
                    section.classList.remove('fade-out');
                }, 300);
            }
        });

        document.getElementById('addImageBtn').addEventListener('click', function() {
            const container = document.getElementById('diaryImagesContainer');
            const inputDiv = document.createElement('div');
            inputDiv.className = 'album-image-input fade-in';
            inputDiv.innerHTML = `
                <input type="text" name="diaryImage[]" placeholder="图片文件名或外部链接"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                <button type="button" class="remove-image bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg transition-smooth">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            `;
            container.appendChild(inputDiv);

            // 添加删除功能
            inputDiv.querySelector('.remove-image').addEventListener('click', function() {
                const item = this.parentElement;
                item.classList.add('fade-out');
                setTimeout(() => {
                    item.remove();
                }, 300);
            });
        });

        // 相册类型切换
        document.querySelectorAll('input[name="albumType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const section = document.getElementById('externalAlbumSection');
                if(this.value === 'external') {
                    section.classList.remove('hidden');
                    setTimeout(() => {
                        section.classList.add('fade-in');
                    }, 1);
                } else {
                    section.classList.add('fade-out');
                    setTimeout(() => {
                        section.classList.add('hidden');
                        section.classList.remove('fade-out');
                    }, 300);
                }
            });
        });

        // 添加相册图片功能
        document.getElementById('addPhotoBtn').addEventListener('click', function() {
            const container = document.getElementById('photosContainer');
            const inputDiv = document.createElement('div');
            inputDiv.className = 'album-image-input fade-in';
            inputDiv.innerHTML = `
                <input type="text" name="photoSrc[]" placeholder="图片链接"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                <button type="button" class="remove-photo bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg transition-smooth">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            `;
            container.appendChild(inputDiv);

            // 添加删除功能
            inputDiv.querySelector('.remove-photo').addEventListener('click', function() {
                const item = this.parentElement;
                item.classList.add('fade-out');
                setTimeout(() => {
                    item.remove();
                }, 300);
            });
        });

        // 获取当前日期函数
        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 为日期输入框设置默认值
        document.getElementById('normalPublished').value = getCurrentDate();
        document.getElementById('diaryDate').value = getCurrentDate();
        document.getElementById('albumDate').value = getCurrentDate();

        // 生成内容函数
        function generateMarkdown(type) {
            let title, date, description, tags = [], category, content;
            const extraFields = {};

            switch(type) {
                case 'normal': // 帖子
                    title = document.getElementById('normalTitle').value;
                    date = document.getElementById('normalPublished').value || getCurrentDate();
                    description = document.getElementById('normalDescription').value;
                    tags = document.getElementById('normalTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                    category = document.getElementById('normalCategory').value;
                    content = document.getElementById('normalContent').value;

                    // 处理额外字段，确保published字段存在以通过构建验证
                    extraFields.image = document.getElementById('normalUseImage').checked ?
                        document.getElementById('normalImage').value : undefined;
                    extraFields.draft = document.getElementById('normalDraft').checked;
                    extraFields.pinned = document.getElementById('normalPinned').checked;
                    // 添加published字段以确保构建成功
                    extraFields.published = date;
                    if(document.getElementById('normalUsePassword').checked) {
                        extraFields.password = document.getElementById('normalPassword').value;
                        // 当有密码时，同时添加加密标志
                        extraFields.encrypted = true;
                    }
                    break;

                case 'diary': // 日记
                    title = document.getElementById('diaryTitle').value;
                    date = document.getElementById('diaryDate').value || getCurrentDate();
                    description = document.getElementById('diaryDescription')?.value || "";
                    tags = (document.getElementById('diaryTags')?.value || "").split(',').map(tag => tag.trim()).filter(tag => tag);
                    content = document.getElementById('diaryContent').value;

                    // 为日记类型添加日期字段
                    extraFields.date = date;

                    // 处理图片
                    if(document.getElementById('diaryUseImage').checked) {
                        const imageInputs = document.querySelectorAll('#diaryImagesContainer input[name="diaryImage[]"]');
                        extraFields.images = Array.from(imageInputs).map(input => input.value).filter(val => val);
                    }
                    break;

                case 'album': // 相册
                    title = document.getElementById('albumTitle').value;
                    const albumId = document.getElementById('albumId').value;
                    date = document.getElementById('albumDate').value || getCurrentDate();
                    description = document.getElementById('albumDescription').value;
                    const location = document.getElementById('albumLocation').value;
                    tags = document.getElementById('albumTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                    const layout = document.getElementById('albumLayout').value;
                    const columns = parseInt(document.getElementById('albumColumns').value);
                    const cover = document.getElementById('albumCover').value;
                    const hidden = document.getElementById('albumHidden').checked;
                    const mode = document.querySelector('input[name="albumType"]:checked').value;

                    // 处理相册中的照片
                    let photos = [];
                    if(mode === 'external') {
                        const photoInputs = document.querySelectorAll('#photosContainer input[name="photoSrc[]"]');
                        photos = Array.from(photoInputs).map(input => ({
                            src: input.value,
                            alt: "Photo"
                        })).filter(photo => photo.src);
                    }

                    // 创建内容
                    content = `# ${title}\n\n${description || '这是一个相册页面'}`;

                    // 返回相册格式的数据
                    const albumData = {
                        title,
                        id: albumId,
                        date,
                        description: description || "",
                        location: location || "",
                        tags: tags.length ? tags : [],
                        layout: layout || "grid",
                        columns: columns || 3,
                        cover,
                        hidden: hidden || false,
                        mode: mode || "local",
                        photos
                    };

                    // 生成相册的Markdown内容
                    const albumFrontmatter = `---
title: "${albumData.title}"
id: "${albumData.id}"
date: ${albumData.date}
description: "${albumData.description}"
location: "${albumData.location}"
tags: [${albumData.tags.map(tag => `"${tag}"`).join(', ')}]
layout: "${albumData.layout}"
columns: ${albumData.columns}
cover: "${albumData.cover}"
hidden: ${albumData.hidden}
mode: "${albumData.mode}"
${albumData.photos.length > 0 ? `photos:\n${albumData.photos.map(photo => `  - src: "${photo.src}"\n    alt: "${photo.alt}"`).join('\n')}` : ''}
---

${content}`;

                    // 设置文件名
                    document.getElementById('fileName').value = `${albumData.id}.md`;
                    document.getElementById('fileDirectory').value = 'src/content/albums';

                    document.getElementById('markdownResult').textContent = albumFrontmatter;
                    return; // 提前返回，因为我们已经设置了结果
            }

            // 构建Frontmatter，只包含published字段（完全按照您的要求）
            let frontmatter = `---\ntitle: "${title}"`;

            // 对于帖子类型，只包含published字段（完全按照您的要求）
            if (type === 'normal') {
                frontmatter += `\npublished: ${date}`;
            }
            // 相册和日记类型不需要published字段

            if(description) frontmatter += `\ndescription: "${description}"`;
            if(category) frontmatter += `\ncategory: "${category}"`;
            if(tags.length > 0) frontmatter += `\ntags: [${tags.map(tag => `"${tag}"`).join(', ')}]`;

            // 添加额外字段（避免重复添加已有的字段）
            Object.entries(extraFields).forEach(([key, value]) => {
                if(value !== undefined) {
                    // 跳过已显式添加的字段，避免重复
                    if (type === 'normal' && key === 'published') {
                        return; // published字段已添加，跳过
                    }

                    if(typeof value === 'string') {
                        frontmatter += `\n${key}: "${value}"`;
                    } else if(typeof value === 'boolean' || typeof value === 'number') {
                        frontmatter += `\n${key}: ${value}`;
                    } else if(Array.isArray(value)) {
                        frontmatter += `\n${key}: [${value.map(v => `"${v}"`).join(', ')}]`;
                    } else if(typeof value === 'object') {
                        frontmatter += `\n${key}: ${JSON.stringify(value, null, 2).split('\n').join('\n  ')}`;
                    }
                }
            });

            frontmatter += '\n---\n\n';

            // 最终内容 = Frontmatter + 内容
            const fullContent = frontmatter + content;

            // 设置文件名 - 使用日期-标题格式，支持中文字符
            const slug = title.toLowerCase()
                             .replace(/[^\w\s\u4e00-\u9fff]/g, '')  // 允许字母、数字、空格和中文字符
                             .replace(/\s+/g, '-');                // 空格替换为短横线

            document.getElementById('fileName').value = slug ? `${date}-${slug}.md` : `${date}-untitled.md`;

            document.getElementById('fileDirectory').value =
                type === 'normal' ? 'src/content/posts' :
                type === 'diary' ? 'src/content/diary' : 'src/content/albums';

            // 显示在结果区域
            document.getElementById('markdownResult').textContent = fullContent;
        }

        // 为提交按钮添加事件监听器
        document.getElementById('normalSubmitButton').addEventListener('click', () => generateMarkdown('normal'));
        document.getElementById('diarySubmitButton').addEventListener('click', () => generateMarkdown('diary'));
        document.getElementById('albumSubmitButton').addEventListener('click', () => generateMarkdown('album'));

        // 为所有输入字段添加实时预览功能
        const inputs = document.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            if (input.type !== 'checkbox' && input.type !== 'radio') {
                input.addEventListener('input', function() {
                    // 获取当前活动的表单
                    const activeForm = document.querySelector('.form-content:not(.hidden)');
                    if (activeForm) {
                        const formType = activeForm.id.replace('Form', '');
                        generateMarkdown(formType);
                    }
                });
            }
        });

        // 为复选框添加监听
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const activeForm = document.querySelector('.form-content:not(.hidden)');
                if (activeForm) {
                    const formType = activeForm.id.replace('Form', '');
                    generateMarkdown(formType);
                }
            });
        });

        // 为单选按钮添加监听
        const radios = document.querySelectorAll('input[type="radio"]');
        radios.forEach(radio => {
            radio.addEventListener('change', function() {
                const activeForm = document.querySelector('.form-content:not(.hidden)');
                if (activeForm) {
                    const formType = activeForm.id.replace('Form', '');
                    generateMarkdown(formType);
                }
            });
        });

        // 复制功能
        document.getElementById('copyButton').addEventListener('click', function() {
            const code = document.getElementById('markdownResult').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fa fa-check mr-1" aria-hidden="true"></i>已复制';
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 2000);
            });
        });

        // 显示密钥输入模态框
        function showTokenModal() {
            document.getElementById('tokenModal').classList.add('active');
            document.getElementById('tokenInput').focus();
        }

        // 隐藏密钥输入模态框
        function hideTokenModal() {
            document.getElementById('tokenModal').classList.remove('active');
            document.getElementById('tokenInput').value = '';
        }

        // 显示提交反馈模态框
        function showFeedbackModal(message) {
            document.getElementById('feedbackText').textContent = message;
            document.getElementById('feedbackModal').classList.add('active');
        }

        // 隐藏提交反馈模态框
        function hideFeedbackModal() {
            document.getElementById('feedbackModal').classList.remove('active');
        }

        // 显示成功提示模态框
        function showSuccessModal(message) {
            // 确保之前的反馈模态框已关闭
            hideFeedbackModal();
            // 设置成功信息并显示成功模态框
            document.getElementById('successText').textContent = message;
            document.getElementById('successModal').classList.add('active');
            // 自动关闭模态框
            setTimeout(() => {
                if (document.getElementById('successModal').classList.contains('active')) {
                    hideSuccessModal();
                }
            }, 3000); // 3秒后自动关闭
        }

        // 隐藏成功提示模态框
        function hideSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        // 检查认证状态的函数
        function checkAuthStatus() {
            const token = localStorage.getItem('github_access_token');
            const authStatusIndicators = document.querySelectorAll('.text-xs.text\\[\\#94a3b8\\].flex.items-center');

            if (token) {
                // 有有效令牌，显示已认证状态
                authStatusIndicators.forEach(indicator => {
                    if (indicator.innerHTML.includes('已认证')) {
                        indicator.innerHTML = '<i class="fas fa-circle text-green-500 mr-1 text-[6px]"></i>已认证';
                    } else if (indicator.innerHTML.includes('未认证')) {
                        indicator.innerHTML = '<i class="fas fa-circle text-red-500 mr-1 text-[6px]"></i>未认证';
                        indicator.classList.add('opacity-50'); // 降低未认证状态的透明度
                    }
                });
            } else {
                // 没有令牌，显示未认证状态
                authStatusIndicators.forEach(indicator => {
                    if (indicator.innerHTML.includes('未认证')) {
                        indicator.innerHTML = '<i class="fas fa-circle text-red-500 mr-1 text-[6px]"></i>未认证';
                    } else if (indicator.innerHTML.includes('已认证')) {
                        indicator.innerHTML = '<i class="fas fa-circle text-green-500 mr-1 text-[6px]"></i>已认证';
                        indicator.classList.add('opacity-50'); // 降低已认证状态的透明度
                    }
                });
            }
        }

        // 初始化时检查认证状态
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
        });

        // 提交到GitHub功能
        document.getElementById('saveToGithub').addEventListener('click', async function() {
            const content = document.getElementById('markdownResult').textContent;
            const fileName = document.getElementById('fileName').value;
            const directory = document.getElementById('fileDirectory').value;

            if (!content || !fileName) {
                alert('请先生成内容并填写文件名');
                return;
            }

            // 检查认证状态
            let token = localStorage.getItem('github_access_token');

            if (!token) {
                // 显示自定义密钥输入模态框
                showTokenModal();
                return;
            }

            // 开始提交过程
            showFeedbackModal('正在验证密钥...');

            try {
                // 验证令牌
                const validateResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!validateResponse.ok) {
                    const tokenResponse = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${token}`
                        }
                    });

                    if (!tokenResponse.ok) {
                        hideFeedbackModal();
                        localStorage.removeItem('github_access_token'); // 移除无效令牌
                        throw new Error('认证令牌无效或已过期，请重新输入');
                    }
                }

                // 构建完整路径
                const filePath = `${directory}/${fileName}`;

                // 更新反馈信息
                showFeedbackModal('正在读取文件信息...');

                // 读取当前文件以获取SHA（如果文件已存在）
                let sha = null;
                try {
                    const response = await fetch(`https://api.github.com/repos/Doulor/Blog/contents/${filePath}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    console.log('文件不存在，将创建新文件');
                }

                // 正确编码内容，支持UTF-8编码
                const uint8Array = new TextEncoder().encode(content);
                let binary = '';
                for (let i = 0; i < uint8Array.length; i++) {
                  binary += String.fromCharCode(uint8Array[i]);
                }
                const base64Content = btoa(binary);

                // 准备提交数据
                const commitData = {
                    message: `添加/更新 ${filePath} [通过内容管理器]`,
                    content: base64Content,
                    branch: 'main'
                };

                if (sha) {
                    commitData.sha = sha; // 如果文件存在，需要提供SHA
                }

                // 更新反馈信息
                showFeedbackModal('正在提交文件到GitHub...');

                // 提交文件
                const result = await fetch(`https://api.github.com/repos/Doulor/Blog/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(commitData)
                });

                const resultData = await result.json();

                hideFeedbackModal(); // 隐藏加载模态框

                if (result.ok) {
                    // 成功提交
                    hideFeedbackModal(); // 隐藏之前的加载模态框
                    showFeedbackModal('提交成功！');
                    setTimeout(() => {
                        hideFeedbackModal();
                        showSuccessModal('文件已成功提交到GitHub仓库！');
                    }, 1500);
                } else {
                    console.error('提交失败:', resultData);
                    if (resultData.message && resultData.message.includes('Bad credentials')) {
                        localStorage.removeItem('github_access_token'); // 移除无效令牌
                        alert('认证令牌无效或已过期，请重新输入');
                    } else {
                        alert('提交失败: ' + (resultData.message || JSON.stringify(resultData)));
                    }
                }
            } catch (error) {
                hideFeedbackModal(); // 隐藏加载模态框
                console.error('提交错误:', error);
                if (error.message.includes('fetch') || error.message.includes('network')) {
                    alert('网络连接错误，请检查网络连接后重试');
                } else {
                    alert('提交过程中发生错误: ' + error.message);
                }
            }
        });

        // 密钥输入模态框事件监听
        document.getElementById('submitTokenBtn').addEventListener('click', async function() {
            const token = document.getElementById('tokenInput').value;
            const saveToken = document.getElementById('saveTokenCheckbox').checked;

            if (!token) {
                alert('请输入访问令牌');
                return;
            }

            // 验证令牌
            showFeedbackModal('正在验证密钥...');
            try {
                const validateResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!validateResponse.ok) {
                    const tokenResponse = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${token}`
                        }
                    });

                    if (!tokenResponse.ok) {
                        hideFeedbackModal();
                        throw new Error('认证令牌无效或已过期，请重新输入');
                    }
                }

                // 令牌验证成功，保存到本地存储（如果用户选择保存）
                if (saveToken) {
                    localStorage.setItem('github_access_token', token);
                }

                // 隐藏模态框
                hideTokenModal();

                // 更新认证状态显示
                checkAuthStatus();

                // 开始提交过程
                const content = document.getElementById('markdownResult').textContent;
                const fileName = document.getElementById('fileName').value;
                const directory = document.getElementById('fileDirectory').value;

                if (!content || !fileName) {
                    alert('请先生成内容并填写文件名');
                    return;
                }

                hideFeedbackModal(); // 隐藏验证模态框

                // 重新调用提交逻辑
                showFeedbackModal('正在提交文件到GitHub...');

                const filePath = `${directory}/${fileName}`;

                // 读取当前文件以获取SHA（如果文件已存在）
                let sha = null;
                try {
                    const response = await fetch(`https://api.github.com/repos/Doulor/Blog/contents/${filePath}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    console.log('文件不存在，将创建新文件');
                }

                // 正确编码内容，支持UTF-8编码
                const uint8Array = new TextEncoder().encode(content);
                let binary = '';
                for (let i = 0; i < uint8Array.length; i++) {
                  binary += String.fromCharCode(uint8Array[i]);
                }
                const base64Content = btoa(binary);

                // 准备提交数据
                const commitData = {
                    message: `添加/更新 ${filePath} [通过内容管理器]`,
                    content: base64Content,
                    branch: 'main'
                };

                if (sha) {
                    commitData.sha = sha; // 如果文件存在，需要提供SHA
                }

                // 提交文件
                const result = await fetch(`https://api.github.com/repos/Doulor/Blog/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(commitData)
                });

                const resultData = await result.json();

                hideFeedbackModal(); // 隐藏加载模态框

                if (result.ok) {
                    // 成功提交
                    hideFeedbackModal(); // 隐藏之前的加载模态框
                    showFeedbackModal('提交成功！');
                    setTimeout(() => {
                        hideFeedbackModal();
                        showSuccessModal('文件已成功提交到GitHub仓库！');
                    }, 1500);
                } else {
                    console.error('提交失败:', resultData);
                    if (resultData.message && resultData.message.includes('Bad credentials')) {
                        localStorage.removeItem('github_access_token'); // 移除无效令牌
                        alert('认证令牌无效或已过期，请重新输入');
                    } else {
                        alert('提交失败: ' + (resultData.message || JSON.stringify(resultData)));
                    }
                }
            } catch (error) {
                hideFeedbackModal(); // 隐藏加载模态框
                console.error('提交错误:', error);
                if (error.message.includes('fetch') || error.message.includes('network')) {
                    alert('网络连接错误，请检查网络连接后重试');
                } else {
                    alert('提交过程中发生错误: ' + error.message);
                }
            }
        });

        // 取消密钥输入事件监听
        document.getElementById('cancelTokenBtn').addEventListener('click', function() {
            hideTokenModal();
        });

        // 点击模态框外部区域关闭模态框
        document.getElementById('tokenModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideTokenModal();
            }
        });

        document.getElementById('feedbackModal').addEventListener('click', function(e) {
            if (e.target === this) {
                // 不允许通过点击外部关闭反馈模态框，因为它代表正在处理中
            }
        });

        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideSuccessModal();
            }
        });

        // 页面可见性变化时检查认证状态
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                setTimeout(checkAuthStatus, 500);
            }
        });

        // 暴露函数给全局作用域
        window.getCurrentDate = getCurrentDate;
        window.generateMarkdown = generateMarkdown;
    </script>
</body>
</html>