<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firef 博客内容管理器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        neutral: '#64748B',
                        light: '#F8FAFC',
                        dark: '#1E293B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.02);
            }
            .transition-smooth {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            .tab-active {
                border-bottom: 2px solid #4F46E5;
                color: #4F46E5;
                font-weight: 500;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .album-image-input {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen font-sans text-dark">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="text-center mb-10">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-primary mb-2 tracking-tight">
                <i class="fa fa-file-text-o mr-3" aria-hidden="true"></i>Firef、内容管理器
            </h1>
            <p class="text-neutral text-lg max-w-2xl mx-auto">集成您的编辑器与 GitHub 提交功能</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white rounded-2xl p-6 card-shadow transform hover:scale-[1.01] transition-smooth">
                <div class="flex border-b border-slate-200 mb-6">
                    <button id="normalTab" class="tab-btn py-2 px-6 text-left transition-smooth tab-active" data-target="normalForm">
                        <i class="fa fa-file-text mr-2" aria-hidden="true"></i>帖子文档
                    </button>
                    <button id="diaryTab" class="tab-btn py-2 px-6 text-left text-neutral transition-smooth" data-target="diaryForm">
                        <i class="fa fa-book mr-2" aria-hidden="true"></i>日记文档
                    </button>
                    <button id="albumTab" class="tab-btn py-2 px-6 text-left text-neutral transition-smooth" data-target="albumForm">
                        <i class="fa fa-picture-o mr-2" aria-hidden="true"></i>相册配置
                    </button>
                </div>

                <!-- 帖子表单 -->
                <form id="normalForm" class="form-content space-y-5">
                    <div class="space-y-2">
                        <label for="normalTitle" class="block text-sm font-medium text-neutral">标题 <span class="text-red-500">*</span></label>
                        <input type="text" id="normalTitle" name="normalTitle" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：我的中文帖子">
                    </div>
                    <div class="space-y-2">
                        <label for="normalPublished" class="block text-sm font-medium text-neutral">发布日期</label>
                        <input type="date" id="normalPublished" name="normalPublished"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                    </div>
                    <div class="space-y-2">
                        <label for="normalDescription" class="block text-sm font-medium text-neutral">描述</label>
                        <textarea id="normalDescription" name="normalDescription" rows="2"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth resize-none"
                            placeholder="添加文档描述信息"></textarea>
                    </div>
                    <div class="space-y-2">
                        <label for="normalTags" class="block text-sm font-medium text-neutral">标签 (用逗号分隔)</label>
                        <input type="text" id="normalTags" name="normalTags"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：诗歌，测试">
                    </div>
                    <div class="space-y-2">
                        <label for="normalCategory" class="block text-sm font-medium text-neutral">分类</label>
                        <input type="text" id="normalCategory" name="normalCategory"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：创作">
                    </div>

                    <!-- 所有复选框选项组合在一起 -->
                    <div class="space-y-4 pt-2">
                        <!-- 图片选项 -->
                        <div>
                            <div class="flex items-center space-x-2 mb-3">
                                <input type="checkbox" id="normalUseImage" name="normalUseImage"
                                    class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                                <label for="normalUseImage" class="text-sm font-medium text-neutral">添加封面图片</label>
                            </div>
                            <div id="normalImageSection" class="hidden pl-7 space-y-2 fade-in">
                                <label for="normalImage" class="block text-sm font-medium text-neutral">图片文件名（含后缀）</label>
                                <input type="text" id="normalImage" name="normalImage"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                                    placeholder="例如：online.jpg">
                            </div>
                        </div>

                        <!-- 设为草稿 -->
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="normalDraft" name="normalDraft"
                                class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                            <label for="normalDraft" class="text-sm font-medium text-neutral">设为草稿</label>
                        </div>

                        <!-- 密码保护 -->
                        <div>
                            <div class="flex items-center space-x-2 mb-3">
                                <input type="checkbox" id="normalUsePassword" name="normalUsePassword"
                                    class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                                <label for="normalUsePassword" class="text-sm font-medium text-neutral">设置密码保护</label>
                            </div>
                            <div id="normalPasswordSection" class="hidden pl-7 space-y-2 fade-in">
                                <label for="normalPassword" class="block text-sm font-medium text-neutral">密码</label>
                                <input type="text" id="normalPassword" name="normalPassword" value="666999"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                            </div>
                        </div>

                        <!-- 置顶帖子 -->
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="normalPinned" name="normalPinned"
                                class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                            <label for="normalPinned" class="text-sm font-medium text-neutral">置顶帖子</label>
                        </div>
                    </div>
                    <!-- 复选框组合结束 -->

                    <div class="space-y-2 pt-3">
                        <label for="normalContent" class="block text-sm font-medium text-neutral">正文内容</label>
                        <textarea id="normalContent" name="normalContent" rows="6"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth resize-none"
                            placeholder="请输入文档正文内容..."></textarea>
                    </div>

                    <div class="pt-4">
                        <button type="button" id="normalSubmitButton" class="generate-btn w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-xl transition-smooth flex items-center justify-center" data-type="normal">
                            <i class="fa fa-magic mr-2" aria-hidden="true"></i>生成帖子文档
                        </button>
                    </div>
                </form>

                <!-- 日记表单 -->
                <form id="diaryForm" class="form-content space-y-5 hidden">
                    <div class="space-y-2">
                        <label for="diaryTitle" class="block text-sm font-medium text-neutral">日记标题 <span class="text-red-500">*</span></label>
                        <input type="text" id="diaryTitle" name="diaryTitle" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：我的中文日记">
                    </div>
                    <div class="space-y-2">
                        <label for="diaryDate" class="block text-sm font-medium text-neutral">日记日期</label>
                        <input type="date" id="diaryDate" name="diaryDate"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                    </div>
                    <!-- 日记图片开关部分 -->
                    <div class="pt-2">
                        <div class="flex items-center space-x-2 mb-3">
                            <input type="checkbox" id="diaryUseImage" name="diaryUseImage"
                                class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                            <label for="diaryUseImage" class="text-sm font-medium text-neutral">添加图片</label>
                        </div>
                        <div id="diaryImageSection" class="hidden pl-7 space-y-3 fade-in">
                            <label class="block text-sm font-medium text-neutral">图片文件名或外部链接</label>
                            <div id="diaryImagesContainer" class="space-y-2">
                                <!-- 图片输入框将动态添加到这里 -->
                            </div>
                            <button type="button" id="addImageBtn" class="text-sm text-primary hover:text-primary/80 transition-smooth flex items-center">
                                <i class="fa fa-plus mr-1" aria-hidden="true"></i> 添加图片
                            </button>
                        </div>
                    </div>
                    <!-- 日记图片开关部分结束 -->
                    <div class="space-y-2 pt-2">
                        <label for="diaryContent" class="block text-sm font-medium text-neutral">日记内容</label>
                        <textarea id="diaryContent" name="diaryContent" rows="8"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth resize-none"
                            placeholder="今天天气很好..."></textarea>
                    </div>

                    <div class="pt-2">
                        <button type="button" id="diarySubmitButton" class="generate-btn w-full bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-6 rounded-xl transition-smooth flex items-center justify-center" data-type="diary">
                            <i class="fa fa-book mr-2" aria-hidden="true"></i>生成日记文档
                        </button>
                    </div>
                </form>

                <!-- 相册表单 -->
                <form id="albumForm" class="form-content space-y-5 hidden">
                    <div class="space-y-2">
                        <label for="albumTitle" class="block text-sm font-medium text-neutral">相册标题 <span class="text-red-500">*</span></label>
                        <input type="text" id="albumTitle" name="albumTitle" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：我的旅行相册">
                    </div>
                    <div class="space-y-2">
                        <label for="albumId" class="block text-sm font-medium text-neutral">相册ID <span class="text-red-500">*</span></label>
                        <input type="text" id="albumId" name="albumId" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：my-travel-album (小写，用短横杠连接)">
                    </div>
                    <div class="space-y-2">
                        <label for="albumDate" class="block text-sm font-medium text-neutral">创建日期</label>
                        <input type="date" id="albumDate" name="albumDate"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                    </div>
                    <div class="space-y-2">
                        <label for="albumDescription" class="block text-sm font-medium text-neutral">相册描述</label>
                        <textarea id="albumDescription" name="albumDescription" rows="2"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth resize-none"
                            placeholder="描述这个相册的内容..."></textarea>
                    </div>
                    <div class="space-y-2">
                        <label for="albumLocation" class="block text-sm font-medium text-neutral">拍摄地点</label>
                        <input type="text" id="albumLocation" name="albumLocation"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：日本，东京">
                    </div>
                    <div class="space-y-2">
                        <label for="albumTags" class="block text-sm font-medium text-neutral">标签 (用逗号分隔)</label>
                        <input type="text" id="albumTags" name="albumTags"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth"
                            placeholder="例如：旅行，风景，日本">
                    </div>

                    <!-- 相册选项 -->
                    <div class="space-y-4 pt-2">
                        <!-- 是否隐藏 -->
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="albumHidden" name="albumHidden"
                                class="w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary/50 transition-smooth">
                            <label for="albumHidden" class="text-sm font-medium text-neutral">隐藏相册</label>
                        </div>
                    </div>

                    <!-- 相册类型选择 -->
                    <div class="pt-3">
                        <label class="block text-sm font-medium text-neutral mb-3">相册类型</label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="flex items-center space-x-2 p-3 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-smooth">
                                <input type="radio" name="albumType" value="local" checked
                                    class="w-4 h-4 text-primary border-slate-300 focus:ring-primary/50">
                                <div>
                                    <div class="font-medium text-neutral">本地相册</div>
                                    <div class="text-xs text-slate-500">上传图片到本地图库</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-2 p-3 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-smooth">
                                <input type="radio" name="albumType" value="external"
                                    class="w-4 h-4 text-primary border-slate-300 focus:ring-primary/50">
                                <div>
                                    <div class="font-medium text-neutral">外部相册</div>
                                    <div class="text-xs text-slate-500">使用外部图片链接</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- 相册布局选项 -->
                    <div class="pt-3 space-y-4">
                        <div class="space-y-2">
                            <label for="albumLayout" class="block text-sm font-medium text-neutral">布局方式</label>
                            <select id="albumLayout" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                                <option value="grid">网格布局</option>
                                <option value="masonry">瀑布流布局</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label for="albumColumns" class="block text-sm font-medium text-neutral">列数</label>
                            <input type="number" id="albumColumns" min="1" max="6" value="3"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                        </div>
                        <div class="space-y-2">
                            <label for="albumCover" class="block text-sm font-medium text-neutral">封面图片</label>
                            <input type="text" id="albumCover" placeholder="相册封面图片路径"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                        </div>
                    </div>

                    <!-- 外部相册图片输入 -->
                    <div id="externalAlbumSection" class="hidden space-y-3 pt-4">
                        <label class="block text-sm font-medium text-neutral">相册图片 <small class="text-slate-500">(外部链接)</small></label>
                        <div id="photosContainer" class="space-y-2">
                            <!-- 图片输入框将动态添加 -->
                        </div>
                        <button type="button" id="addPhotoBtn" class="text-sm text-primary hover:text-primary/80 transition-smooth flex items-center">
                            <i class="fa fa-plus mr-1" aria-hidden="true"></i> 添加图片
                        </button>
                    </div>

                    <div class="pt-4">
                        <button type="button" id="albumSubmitButton" class="generate-btn w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-6 rounded-xl transition-smooth flex items-center justify-center" data-type="album">
                            <i class="fa fa-picture-o mr-2" aria-hidden="true"></i>生成相册文档
                        </button>
                    </div>
                </form>
            </div>

            <!-- 结果和控制面板 -->
            <div class="bg-white rounded-2xl p-6 card-shadow">
                <div class="border-b border-slate-200 pb-4 mb-6">
                    <h2 class="text-xl font-semibold text-dark flex items-center">
                        <i class="fa fa-code mr-2 text-primary" aria-hidden="true"></i>生成结果
                    </h2>
                    <p class="text-sm text-neutral mt-1">生成的Frontmatter文档格式，可直接用于博客</p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label for="fileName" class="block text-sm font-medium text-neutral mb-2">文件名</label>
                        <input type="text" id="fileName" placeholder="例如：2024-12-15-my-post.md"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                        <p class="text-xs text-slate-500 mt-1">请包含正确的文件扩展名(.md)和日期前缀</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-neutral mb-2">文件路径</label>
                        <div class="flex space-x-2">
                            <select id="fileDirectory" class="flex-1 px-4 py-3 rounded-xl border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                                <option value="src/content/posts">文章 (src/content/posts)</option>
                                <option value="src/content/diary">日记 (src/content/diary)</option>
                                <option value="src/content/albums">相册 (src/content/albums)</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-neutral mb-2 flex justify-between items-center">
                            <span>生成的内容</span>
                            <button id="copyButton" class="text-sm bg-slate-100 hover:bg-slate-200 text-neutral px-3 py-1 rounded-lg transition-smooth flex items-center">
                                <i class="fa fa-copy mr-1" aria-hidden="true"></i>复制
                            </button>
                        </label>
                        <pre id="markdownResult" class="bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm font-mono whitespace-pre-wrap overflow-x-auto max-h-96 overflow-y-auto"></pre>
                    </div>

                    <div class="pt-4">
                        <button id="saveToGithub" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-xl transition-smooth flex items-center justify-center">
                            <i class="fa fa-github mr-2" aria-hidden="true"></i>提交到 GitHub 仓库
                        </button>
                        <p class="text-xs text-slate-500 mt-2 text-center">需要先完成 GitHub 认证</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 选项卡切换功能
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                // 移除所有活动状态
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('tab-active');
                    btn.classList.add('text-neutral');
                });
                
                // 添加活动状态到当前按钮
                button.classList.add('tab-active');
                button.classList.remove('text-neutral');
                
                // 隐藏所有表单
                document.querySelectorAll('.form-content').forEach(form => {
                    form.classList.add('hidden');
                });
                
                // 显示目标表单
                const target = button.getAttribute('data-target');
                document.getElementById(target).classList.remove('hidden');
            });
        });

        // 图片开关功能
        document.getElementById('normalUseImage').addEventListener('change', function() {
            const section = document.getElementById('normalImageSection');
            if(this.checked) {
                section.classList.remove('hidden');
                section.classList.add('fade-in');
            } else {
                section.classList.add('hidden');
            }
        });

        document.getElementById('normalUsePassword').addEventListener('change', function() {
            const section = document.getElementById('normalPasswordSection');
            if(this.checked) {
                section.classList.remove('hidden');
                section.classList.add('fade-in');
            } else {
                section.classList.add('hidden');
            }
        });

        // 日记图片功能
        document.getElementById('diaryUseImage').addEventListener('change', function() {
            const section = document.getElementById('diaryImageSection');
            if(this.checked) {
                section.classList.remove('hidden');
                section.classList.add('fade-in');
            } else {
                section.classList.add('hidden');
            }
        });

        document.getElementById('addImageBtn').addEventListener('click', function() {
            const container = document.getElementById('diaryImagesContainer');
            const inputDiv = document.createElement('div');
            inputDiv.className = 'album-image-input';
            inputDiv.innerHTML = `
                <input type="text" name="diaryImage[]" placeholder="图片文件名或外部链接"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                <button type="button" class="remove-image bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg transition-smooth">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            `;
            container.appendChild(inputDiv);
            
            // 添加删除功能
            inputDiv.querySelector('.remove-image').addEventListener('click', function() {
                this.parentElement.remove();
            });
        });

        // 相册类型切换
        document.querySelectorAll('input[name="albumType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const section = document.getElementById('externalAlbumSection');
                if(this.value === 'external') {
                    section.classList.remove('hidden');
                    section.classList.add('fade-in');
                } else {
                    section.classList.add('hidden');
                }
            });
        });

        // 添加相册图片功能
        document.getElementById('addPhotoBtn').addEventListener('click', function() {
            const container = document.getElementById('photosContainer');
            const inputDiv = document.createElement('div');
            inputDiv.className = 'album-image-input';
            inputDiv.innerHTML = `
                <input type="text" name="photoSrc[]" placeholder="图片链接"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                <button type="button" class="remove-photo bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg transition-smooth">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            `;
            container.appendChild(inputDiv);
            
            // 添加删除功能
            inputDiv.querySelector('.remove-photo').addEventListener('click', function() {
                this.parentElement.remove();
            });
        });

        // 获取当前日期函数
        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 为日期输入框设置默认值
        document.getElementById('normalPublished').value = getCurrentDate();
        document.getElementById('diaryDate').value = getCurrentDate();
        document.getElementById('albumDate').value = getCurrentDate();

        // 生成内容函数
        function generateMarkdown(type) {
            let title, date, description, tags = [], category, content;
            const extraFields = {};

            switch(type) {
                case 'normal': // 帖子
                    title = document.getElementById('normalTitle').value;
                    date = document.getElementById('normalPublished').value || getCurrentDate();
                    description = document.getElementById('normalDescription').value;
                    tags = document.getElementById('normalTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                    category = document.getElementById('normalCategory').value;
                    content = document.getElementById('normalContent').value;

                    // 处理额外字段
                    extraFields.image = document.getElementById('normalUseImage').checked ?
                        document.getElementById('normalImage').value : undefined;
                    extraFields.draft = document.getElementById('normalDraft').checked;
                    extraFields.pinned = document.getElementById('normalPinned').checked;
                    if(document.getElementById('normalUsePassword').checked) {
                        extraFields.password = document.getElementById('normalPassword').value;
                    }
                    break;

                case 'diary': // 日记
                    title = document.getElementById('diaryTitle').value;
                    date = document.getElementById('diaryDate').value || getCurrentDate();
                    description = document.getElementById('diaryDescription')?.value || "";
                    tags = (document.getElementById('diaryTags')?.value || "").split(',').map(tag => tag.trim()).filter(tag => tag);
                    content = document.getElementById('diaryContent').value;

                    // 处理图片
                    if(document.getElementById('diaryUseImage').checked) {
                        const imageInputs = document.querySelectorAll('#diaryImagesContainer input[name="diaryImage[]"]');
                        extraFields.images = Array.from(imageInputs).map(input => input.value).filter(val => val);
                    }
                    break;

                case 'album': // 相册
                    title = document.getElementById('albumTitle').value;
                    const albumId = document.getElementById('albumId').value;
                    date = document.getElementById('albumDate').value || getCurrentDate();
                    description = document.getElementById('albumDescription').value;
                    const location = document.getElementById('albumLocation').value;
                    tags = document.getElementById('albumTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                    const layout = document.getElementById('albumLayout').value;
                    const columns = parseInt(document.getElementById('albumColumns').value);
                    const cover = document.getElementById('albumCover').value;
                    const hidden = document.getElementById('albumHidden').checked;
                    const mode = document.querySelector('input[name="albumType"]:checked').value;

                    // 处理相册中的照片
                    let photos = [];
                    if(mode === 'external') {
                        const photoInputs = document.querySelectorAll('#photosContainer input[name="photoSrc[]"]');
                        photos = Array.from(photoInputs).map(input => ({
                            src: input.value,
                            alt: "Photo"
                        })).filter(photo => photo.src);
                    }

                    // 创建内容
                    content = `# ${title}\n\n${description || '这是一个相册页面'}`;

                    // 返回相册格式的数据
                    const albumData = {
                        title,
                        id: albumId,
                        date,
                        description: description || "",
                        location: location || "",
                        tags: tags.length ? tags : [],
                        layout: layout || "grid",
                        columns: columns || 3,
                        cover,
                        hidden: hidden || false,
                        mode: mode || "local",
                        photos
                    };

                    // 生成相册的Markdown内容
                    const albumFrontmatter = `---
title: "${albumData.title}"
id: "${albumData.id}"
date: ${albumData.date}
description: "${albumData.description}"
location: "${albumData.location}"
tags: [${albumData.tags.map(tag => `"${tag}"`).join(', ')}]
layout: "${albumData.layout}"
columns: ${albumData.columns}
cover: "${albumData.cover}"
hidden: ${albumData.hidden}
mode: "${albumData.mode}"
${albumData.photos.length > 0 ? `photos:\n${albumData.photos.map(photo => `  - src: "${photo.src}"\n    alt: "${photo.alt}"`).join('\n')}` : ''}
---

${content}`;

                    // 设置文件名
                    document.getElementById('fileName').value = `${albumData.id}.md`;
                    document.getElementById('fileDirectory').value = 'src/content/albums';
                    
                    document.getElementById('markdownResult').textContent = albumFrontmatter;
                    return; // 提前返回，因为我们已经设置了结果
            }

            // 构建Frontmatter
            let frontmatter = `---\ntitle: "${title}"\ndate: ${date}`;
            if(description) frontmatter += `\ndescription: "${description}"`;
            if(category) frontmatter += `\ncategory: "${category}"`;
            if(tags.length > 0) frontmatter += `\ntags: [${tags.map(tag => `"${tag}"`).join(', ')}]`;

            // 添加额外字段
            Object.entries(extraFields).forEach(([key, value]) => {
                if(value !== undefined) {
                    if(typeof value === 'string') {
                        frontmatter += `\n${key}: "${value}"`;
                    } else if(typeof value === 'boolean' || typeof value === 'number') {
                        frontmatter += `\n${key}: ${value}`;
                    } else if(Array.isArray(value)) {
                        frontmatter += `\n${key}: [${value.map(v => `"${v}"`).join(', ')}]`;
                    } else if(typeof value === 'object') {
                        // 处理复杂对象
                        frontmatter += `\n${key}: ${JSON.stringify(value, null, 2).split('\n').join('\n  ')}`;
                    }
                }
            });

            frontmatter += '\n---\n\n';

            // 最终内容 = Frontmatter + 内容
            const fullContent = frontmatter + content;

            // 设置文件名
            const slug = title.toLowerCase().replace(/[^a-z0-9\s]/g, '').replace(/\s+/g, '-');
            document.getElementById('fileName').value = type === 'diary' 
                ? `${date}-${slug}.md` 
                : `${date}-${slug}.md`;
                
            document.getElementById('fileDirectory').value = 
                type === 'normal' ? 'src/content/posts' : 
                type === 'diary' ? 'src/content/diary' : 'src/content/albums';

            // 显示在结果区域
            document.getElementById('markdownResult').textContent = fullContent;
        }

        // 为提交按钮添加事件监听器
        document.getElementById('normalSubmitButton').addEventListener('click', () => generateMarkdown('normal'));
        document.getElementById('diarySubmitButton').addEventListener('click', () => generateMarkdown('diary'));
        document.getElementById('albumSubmitButton').addEventListener('click', () => generateMarkdown('album'));

        // 复制功能
        document.getElementById('copyButton').addEventListener('click', function() {
            const code = document.getElementById('markdownResult').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fa fa-check mr-1" aria-hidden="true"></i>已复制';
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 2000);
            });
        });

        // 提交到GitHub功能（需要认证）
        document.getElementById('saveToGithub').addEventListener('click', async function() {
            const content = document.getElementById('markdownResult').textContent;
            const fileName = document.getElementById('fileName').value;
            const directory = document.getElementById('fileDirectory').value;
            
            if (!content || !fileName) {
                alert('请先生成内容并填写文件名');
                return;
            }
            
            // 构建完整路径
            const filePath = `${directory}/${fileName}`;
            
            // 检查认证状态
            const token = localStorage.getItem('decap-cms-user');
            if (!token) {
                alert('请先通过GitHub认证');
                // 重定向到admin页面进行认证
                window.location.href = '/admin/';
                return;
            }

            // 从存储中获取访问令牌
            let tokenObj;
            try {
                tokenObj = JSON.parse(token);
            } catch (e) {
                console.error('无法解析令牌:', e);
                alert('认证令牌格式错误，请重新认证');
                window.location.href = '/admin/';
                return;
            }

            const accessToken = tokenObj.backend_token || tokenObj.access_token;

            if (!accessToken) {
                alert('认证令牌无效，请重新认证');
                window.location.href = '/admin/';
                return;
            }
            
            try {
                // 使用您的Worker代理来与GitHub API交互
                const proxyUrl = 'https://eblog-editor.2737855297.workers.dev/api/gateway';
                
                // 读取当前文件以获取SHA（如果文件已存在）
                let sha = null;
                try {
                    const response = await fetch(`${proxyUrl}/repos/Doulor/Blog/contents/${filePath}`, {
                        headers: {
                            'Authorization': `token ${accessToken}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    console.log('文件不存在，将创建新文件');
                }
                
                // 准备提交数据
                const commitData = {
                    message: `添加/更新 ${filePath} [通过内容管理器]`,
                    content: btoa(unescape(encodeURIComponent(content))),
                    branch: 'main'
                };
                
                if (sha) {
                    commitData.sha = sha; // 如果文件存在，需要提供SHA
                }
                
                // 提交文件
                const result = await fetch(`${proxyUrl}/repos/Doulor/Blog/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(commitData)
                });
                
                const resultData = await result.json();
                
                if (result.ok) {
                    alert('文件已成功提交到GitHub仓库！');
                    // 可能需要清空表单或提供其他反馈
                } else {
                    alert('提交失败: ' + JSON.stringify(resultData));
                }
            } catch (error) {
                console.error('提交错误:', error);
                alert('提交过程中发生错误: ' + error.message);
            }
        });

        // 暴露函数给全局作用域
        window.getCurrentDate = getCurrentDate;
        window.generateMarkdown = generateMarkdown;
    </script>
</body>
</html>