<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firef CMS - 统一内容编辑器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        },
                        secondary: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        },
                        accent: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        neutral: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        },
                        surface: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 10px 25px -5px rgba(79, 70, 229, 0.05), 0 8px 10px -6px rgba(79, 70, 229, 0.02)',
                        'card-hover': '0 20px 25px -5px rgba(79, 70, 229, 0.1), 0 10px 10px -6px rgba(79, 70, 229, 0.05)',
                        'btn': '0 4px 6px -1px rgba(79, 70, 229, 0.1), 0 2px 4px -1px rgba(79, 70, 229, 0.06)',
                        'btn-hover': '0 6px 12px -2px rgba(79, 70, 229, 0.15), 0 4px 8px -2px rgba(79, 70, 229, 0.1)',
                        'input': '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'input-focus': '0 1px 2px 0 rgba(0, 0, 0, 0.05), 0 0 0 3px rgba(99, 102, 241, 0.2)',
                        'modal': '0 25px 50px -12px rgba(79, 70, 229, 0.25)',
                    },
                    borderRadius: {
                        'card': '1.25rem',
                        'button': '0.75rem',
                        'input': '0.625rem',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            body {
                font-family: 'Inter', system-ui, sans-serif;
                background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            }
        }
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: var(--tw-shadow, 0 0 #0000);
            }
            .transition-smooth {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            .tab-active {
                color: #4f46e5;
                font-weight: 600;
                position: relative;
            }
            .tab-active::after {
                content: '';
                position: absolute;
                bottom: -1px;
                left: 0;
                width: 100%;
                height: 3px;
                background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
                border-radius: 2px;
            }

            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .album-image-input {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
                padding: 0.75rem;
                background: #f8fafc;
                border: 1px solid #e2e8f0;
                border-radius: 0.625rem;
                transition: all 0.2s ease-in-out;
            }

            .album-image-input:hover {
                border-color: #c7d2fe;
                background: #f1f5f9;
            }

            /* 模态框样式 */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(79, 70, 229, 0.3) 0%, rgba(99, 102, 241, 0.2) 100%);
                z-index: 1000;
                justify-content: center;
                align-items: center;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .modal.active {
                display: flex;
                opacity: 1;
                visibility: visible;
            }
            .modal-content {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                padding: 2rem;
                border-radius: 1.25rem;
                width: 90%;
                max-width: 28rem;
                box-shadow: var(--tw-shadow);
                position: relative;
                transform: scale(0.95);
                opacity: 0;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .modal.active .modal-content {
                transform: scale(1);
                opacity: 1;
            }
            .modal-header {
                margin-bottom: 1rem;
                text-align: center;
            }
            .modal-title {
                font-size: 1.25rem;
                font-weight: 600;
                color: #1e293b;
                background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            .modal-body {
                margin-bottom: 1.5rem;
            }
            .modal-input {
                width: 100%;
                padding: 0.75rem;
                border: 1px solid #e2e8f0;
                border-radius: 0.625rem;
                font-size: 1rem;
                margin-top: 0.5rem;
                transition: all 0.2s ease-in-out;
                background: white;
            }
            .modal-input:focus {
                outline: none;
                border-color: #4f46e5;
                box-shadow: var(--tw-shadow);
            }
            .modal-footer {
                display: flex;
                gap: 0.75rem;
                justify-content: center;
            }
            .btn {
                padding: 0.625rem 1.25rem;
                border-radius: 0.75rem;
                font-weight: 500;
                cursor: pointer;
                border: none;
                transition: all 0.2s ease-in-out;
                font-size: 0.95rem;
            }
            .btn-primary {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                color: white;
                box-shadow: var(--tw-shadow);
            }
            .btn-primary:hover {
                background: linear-gradient(135deg, #4338ca 0%, #6d28d9 100%);
                transform: translateY(-2px);
                box-shadow: var(--tw-shadow);
            }
            .btn-secondary {
                background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
                color: #475569;
            }
            .btn-secondary:hover {
                background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
                transform: translateY(-1px);
            }
            .loading-spinner {
                display: inline-block;
                width: 1rem;
                height: 1rem;
                border: 2px solid #f3f4f6;
                border-radius: 50%;
                border-top-color: #4f46e5;
                animation: spin 1s linear infinite;
                margin-right: 0.5rem;
            }
            @keyframes spin {
                to { transform: rotate(360deg); }
            }

            /* 表单切换动画 */
            .form-content {
                transition: all 0.3s ease-in-out;
            }

            /* 选项卡切换动画 */
            .tab-btn {
                position: relative;
                transition: all 0.2s ease-in-out;
                padding: 0.75rem 1.5rem;
                border-radius: 0.75rem;
            }
            .tab-btn:hover {
                background: #f1f5f9;
            }
            .tab-btn::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 0;
                height: 2px;
                background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
                transition: width 0.3s ease-in-out;
            }
            .tab-btn:not(.tab-active):hover::after {
                width: 100%;
            }
            .tab-btn.tab-active::after {
                width: 100%;
            }

            /* 输入框焦点动画 */
            input, textarea {
                transition: all 0.2s ease-in-out;
                border: 1px solid #e2e8f0;
                border-radius: 0.625rem;
            }
            input:focus, textarea:focus {
                outline: none;
                border-color: #c7d2fe;
                box-shadow: var(--tw-shadow);
            }

            /* 按钮悬停动画 */
            .generate-btn {
                transition: all 0.2s ease-in-out;
                padding: 0.75rem 1.5rem;
                border-radius: 0.75rem;
                font-weight: 500;
                font-size: 1rem;
            }
            .generate-btn:hover {
                transform: translateY(-3px);
                box-shadow: var(--tw-shadow);
            }

            /* 卡片悬停动画 */
            .card-shadow {
                transition: all 0.3s ease-in-out;
                border-radius: 1.25rem;
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            }
            .card-shadow:hover {
                transform: translateY(-5px);
                box-shadow: var(--tw-shadow);
            }

            /* 自定义复选框样式 */
            input[type="checkbox"].custom-checkbox {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                width: 1.25rem;
                height: 1.25rem;
                border: 2px solid #cbd5e1;
                border-radius: 0.25rem;
                position: relative;
                cursor: pointer;
                background-color: white;
                transition: all 0.3s ease;
            }

            input[type="checkbox"].custom-checkbox:hover {
                border-color: #4f46e5;
                box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
            }

            input[type="checkbox"].custom-checkbox:checked {
                background-color: #4f46e5;
                border-color: #4f46e5;
            }

            input[type="checkbox"].custom-checkbox:checked::after {
                content: '';
                position: absolute;
                left: 5px;
                top: 2px;
                width: 5px;
                height: 10px;
                border: solid white;
                border-width: 0 2px 2px 0;
                transform: rotate(45deg);
            }

            input[type="checkbox"].custom-checkbox:active {
                transform: scale(0.95);
            }
            @keyframes checkboxChecked {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }

            /* 单选按钮动画 */
            input[type="radio"] {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                width: 1.25rem;
                height: 1.25rem;
                cursor: pointer;
                box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.03);
            }
            input[type="radio"]:hover {
                box-shadow: inset 0 1px 2px 0 rgba(79, 70, 229, 0.2), 0 0 0 2px rgba(79, 70, 229, 0.2);
            }
            input[type="radio"]::before {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                border-radius: 50%;
                background: transparent;
                transform: translate(-50%, -50%);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            input[type="radio"]:checked {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                border-color: #4f46e5;
                animation: radioChecked 0.3s ease-out;
            }
            input[type="radio"]:checked::before {
                width: 0.625rem;
                height: 0.625rem;
                background: white;
            }
            input[type="radio"]:active {
                transform: scale(0.95);
            }
            @keyframes radioChecked {
                0% { transform: scale(1); }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); }
            }

            /* 显示/隐藏动画 */
            .fade-in {
                animation: fadeInAnimation 0.3s ease-in-out;
            }
            @keyframes fadeInAnimation {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* 淡入淡出动画 */
            .fade-out {
                animation: fadeOutAnimation 0.3s ease-in-out;
            }
            @keyframes fadeOutAnimation {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(10px);
                }
            }

            /* 渐变背景 */
            .bg-gradient-card {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            }

            /* 按钮渐变 */
            .btn-gradient {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                color: white;
                border: none;
                box-shadow: var(--tw-shadow);
            }

            @keyframes spin-slow {
                from {
                    transform: rotate(0deg);
                }
                to {
                    transform: rotate(360deg);
                }
            }

            .animate-spin-slow {
                animation: spin-slow 3s linear infinite;
            }

            @keyframes pulse-slow {
                0%, 100% {
                    transform: scale(1);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.2);
                    opacity: 0.8;
                }
            }

            .animate-pulse-slow {
                animation: pulse-slow 2s ease-in-out infinite;
            }

            /* 确保渐变文字在所有浏览器中正常工作 */
            .text-gradient {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                color: transparent;
            }

            .text-gradient-animated {
                background: linear-gradient(45deg, #4f46e5, #7c3aed, #0ea5e9, #10b981, #4f46e5);
                background-size: 300% 300%;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                color: transparent;
                animation: gradientShift 6s ease infinite;
            }

            @keyframes gradientShift {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
        }
    </style>
</head>
<body class="min-h-screen font-sans text-[#1e293b]">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="text-center mb-12 cursor-default">
            <div class="inline-block">
                <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold mb-3 tracking-tight text-gradient-animated inline-flex items-center">
                    <i class="fa fa-file-text-o mr-3" aria-hidden="true"></i>Firef CMS - 内容管理器
                </h1>
                <div class="h-0.5 w-full bg-gradient-to-r from-transparent via-[#10b981] to-transparent rounded-full opacity-60 animate-pulse"></div>
            </div>
            <p class="text-[#64748b] text-lg max-w-2xl mx-auto font-medium mt-6">快速创建博客内容，支持帖子、日记和相册</p>
            <div class="flex justify-center mt-6 space-x-2.5">
                <div class="w-3 h-3 bg-gradient-to-r from-[#4f46e5] to-[#7c3aed] rounded-full animate-bounce hover:animate-ping cursor-pointer" style="animation-delay: 0s; animation-duration: 1s;"></div>
                <div class="w-3 h-3 bg-gradient-to-r from-[#10b981] to-[#059669] rounded-full animate-bounce hover:animate-ping cursor-pointer" style="animation-delay: 0.15s; animation-duration: 1s;"></div>
                <div class="w-3 h-3 bg-gradient-to-r from-[#0ea5e9] to-[#0284c7] rounded-full animate-bounce hover:animate-ping cursor-pointer" style="animation-delay: 0.3s; animation-duration: 1s;"></div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="rounded-[1.25rem] p-6 card-shadow bg-gradient-card transform hover:scale-[1.01] transition-smooth">
                <div class="flex border-b border-[#e2e8f0] mb-6 pb-1">
                    <button id="normalTab" class="tab-btn py-3 px-6 text-left transition-smooth tab-active" data-target="normalForm">
                        <i class="fa fa-file-text mr-2 text-[#4f46e5]" aria-hidden="true"></i>帖子文档
                    </button>
                    <button id="diaryTab" class="tab-btn py-3 px-6 text-left text-[#64748b] transition-smooth" data-target="diaryForm">
                        <i class="fa fa-book mr-2 text-[#10b981]" aria-hidden="true"></i>日记文档
                    </button>
                    <button id="albumTab" class="tab-btn py-3 px-6 text-left text-[#64748b] transition-smooth" data-target="albumForm">
                        <i class="fa fa-picture-o mr-2 text-[#0ea5e9]" aria-hidden="true"></i>相册配置
                    </button>
                </div>

                <!-- 帖子表单 -->
                <form id="normalForm" class="form-content space-y-5">
                    <div class="space-y-2">
                        <label for="normalContent" class="block text-sm font-medium text-[#475569]">帖子正文内容</label>
                        <textarea id="normalContent" name="normalContent" rows="12"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth resize-none"
                            placeholder="请输入帖子正文内容..."></textarea>
                    </div>

                    <div class="pt-4">
                        <button type="button" id="normalSubmitButton" class="generate-btn w-full btn-gradient text-white font-medium py-3 px-6 rounded-[0.75rem] transition-smooth flex items-center justify-center" data-type="normal">
                            <i class="fa fa-magic mr-2" aria-hidden="true"></i>更新帖子内容
                        </button>
                    </div>
                </form>

                <!-- 日记表单 -->
                <form id="diaryForm" class="form-content space-y-5 hidden">
                    <div class="space-y-2">
                        <label for="diaryContent" class="block text-sm font-medium text-[#475569]">日记正文内容</label>
                        <textarea id="diaryContent" name="diaryContent" rows="12"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth resize-none"
                            placeholder="请输入日记正文内容..."></textarea>
                    </div>

                    <div class="pt-2">
                        <button type="button" id="diarySubmitButton" class="generate-btn w-full bg-gradient-to-r from-[#10b981] to-[#059669] text-white font-medium py-3 px-6 rounded-[0.75rem] transition-smooth flex items-center justify-center" data-type="diary">
                            <i class="fa fa-book mr-2" aria-hidden="true"></i>更新日记内容
                        </button>
                    </div>
                </form>

                <!-- 相册表单 -->
                <form id="albumForm" class="form-content space-y-5 hidden">
                    <div class="space-y-2">
                        <label for="albumDescription" class="block text-sm font-medium text-[#475569]">相册描述/正文内容</label>
                        <textarea id="albumDescription" name="albumDescription" rows="12"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth resize-none"
                            placeholder="输入相册描述或正文内容..."></textarea>
                    </div>

                    <div class="pt-4">
                        <button type="button" id="albumSubmitButton" class="generate-btn w-full bg-gradient-to-r from-[#0ea5e9] to-[#0369a1] text-white font-medium py-3 px-6 rounded-[0.75rem] transition-smooth flex items-center justify-center" data-type="album">
                            <i class="fa fa-picture-o mr-2" aria-hidden="true"></i>更新相册内容
                        </button>
                    </div>
                </form>
            </div>

            <!-- 结果和控制面板 -->
            <div class="rounded-[1.25rem] p-6 card-shadow bg-gradient-card">
                <div class="border-b border-[#e2e8f0] pb-4 mb-6">
                    <h2 class="text-xl font-semibold text-[#1e293b] flex items-center">
                        <i class="fa fa-code mr-2 text-[#4f46e5]" aria-hidden="true"></i>生成结果
                    </h2>
                    <p class="text-sm text-[#64748b] mt-1">生成的Frontmatter文档格式，可直接用于博客</p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label for="fileName" class="block text-sm font-medium text-[#475569] mb-2">文件名</label>
                        <input type="text" id="fileName" placeholder="例如：2025-01-01-my-post.md"
                            class="w-full px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                        <p class="text-xs text-[#94a3b8] mt-1">请包含正确的文件扩展名(.md)和日期前缀</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-[#475569] mb-2">文件路径</label>
                        <div class="flex space-x-2">
                            <select id="fileDirectory" class="flex-1 px-4 py-3 input-border focus:border-[#4f46e5] focus:ring-0 outline-none transition-smooth">
                                <option value="src/content/posts">文章 (src/content/posts)</option>
                                <option value="src/content/diary">日记 (src/content/diary)</option>
                                <option value="src/content/albums">相册 (src/content/albums)</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-[#475569] mb-2 flex justify-between items-center">
                            <span>生成的内容</span>
                            <button id="copyButton" class="text-sm bg-[#f1f5f9] hover:bg-[#e2e8f0] text-[#475569] px-3 py-1 rounded-[0.5rem] transition-smooth flex items-center">
                                <i class="fa fa-copy mr-1" aria-hidden="true"></i>复制
                            </button>
                        </label>
                        <pre id="markdownResult" class="bg-[#f8fafc] border border-[#e2e8f0] rounded-[0.625rem] p-4 text-sm font-mono whitespace-pre-wrap overflow-x-auto max-h-96 overflow-y-auto"></pre>
                    </div>

                    <div class="pt-4">
                        <button id="saveToGithub" class="w-full bg-gradient-to-r from-[#10b981] to-[#059669] text-white font-medium py-3 px-6 rounded-[0.75rem] transition-smooth flex items-center justify-center">
                            <i class="fa fa-github mr-2" aria-hidden="true"></i>提交到 GitHub 仓库
                        </button>
                        <p class="text-xs text-[#94a3b8] mt-2 text-center">需要先完成 GitHub 认证</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 密钥输入模态框 -->
    <div id="tokenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">请输入GitHub密钥</h3>
            </div>
            <div class="modal-body">
                <label for="tokenInput" class="block text-sm font-medium text-neutral mb-2">Personal Access Token</label>
                <input type="password" id="tokenInput" class="modal-input" placeholder="输入您的GitHub Personal Access Token">
                <div class="flex items-center mt-3">
                    <input type="checkbox" id="saveTokenCheckbox" class="custom-checkbox">
                    <label for="saveTokenCheckbox" class="ml-2 text-sm text-neutral">保存密钥到浏览器</label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelTokenBtn" class="btn btn-secondary">取消</button>
                <button id="submitTokenBtn" class="btn btn-primary">提交</button>
            </div>
        </div>
    </div>

    <!-- 提交反馈模态框 -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-body flex items-center">
                <span id="loadingSpinner" class="loading-spinner"></span>
                <span id="feedbackText">正在提交到GitHub...</span>
            </div>
        </div>
    </div>

    <!-- 成功提示模态框 -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="flex justify-center mb-4">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-r from-[#10b981] to-[#059669] flex items-center justify-center">
                        <i class="fa fa-check text-white text-2xl" aria-hidden="true"></i>
                    </div>
                </div>
                <p id="successText" class="text-lg font-medium text-[#1e293b]">操作成功完成！</p>
            </div>
        </div>
    </div>

    <script>
        // 选项卡切换功能
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                // 移除所有活动状态
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.add('text-neutral');
                    btn.classList.remove('tab-active');
                });

                // 添加活动状态到当前按钮
                button.classList.add('tab-active');
                button.classList.remove('text-neutral');

                // 获取目标表单
                const target = button.getAttribute('data-target');
                const targetForm = document.getElementById(target);

                // 获取当前显示的表单
                const currentForm = document.querySelector('.form-content:not(.hidden):not(.fade-out)');

                // 如果有当前表单正在显示，则先淡出
                if (currentForm && currentForm !== targetForm) {
                    currentForm.classList.add('fade-out');
                    setTimeout(() => {
                        currentForm.classList.add('hidden');
                        currentForm.classList.remove('fade-out');

                        // 然后淡入目标表单
                        targetForm.classList.remove('hidden');
                        setTimeout(() => {
                            targetForm.classList.add('fade-in');

                            // 隐藏完成后生成Markdown
                            setTimeout(() => {
                                const formType = target.replace('Form', '');
                                generateMarkdown(formType);
                            }, 300);
                        }, 1);
                    }, 300);
                } else {
                    // 如果没有当前表单（首次加载）或点击的是当前表单，直接显示目标表单
                    document.querySelectorAll('.form-content').forEach(form => {
                        if (form !== targetForm) {
                            form.classList.add('hidden');
                        }
                    });
                    targetForm.classList.remove('hidden');
                    targetForm.classList.add('fade-in');

                    const formType = target.replace('Form', '');
                    generateMarkdown(formType);

                    // 添加完成后移除fade-in类，以防止重复动画
                    setTimeout(() => {
                        if (targetForm.classList.contains('fade-in')) {
                            targetForm.classList.remove('fade-in');
                        }
                    }, 300);
                }
            });
        });

        // 图片开关功能
        document.getElementById('normalUseImage').addEventListener('change', function() {
            const section = document.getElementById('normalImageSection');
            if(this.checked) {
                section.classList.remove('hidden');
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 1);
            } else {
                section.classList.add('fade-out');
                setTimeout(() => {
                    section.classList.add('hidden');
                    section.classList.remove('fade-out');
                }, 300);
            }
        });

        document.getElementById('normalUsePassword').addEventListener('change', function() {
            const section = document.getElementById('normalPasswordSection');
            if(this.checked) {
                section.classList.remove('hidden');
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 1);
            } else {
                section.classList.add('fade-out');
                setTimeout(() => {
                    section.classList.add('hidden');
                    section.classList.remove('fade-out');
                }, 300);
            }
        });

        // 日记图片功能
        document.getElementById('diaryUseImage').addEventListener('change', function() {
            const section = document.getElementById('diaryImageSection');
            if(this.checked) {
                section.classList.remove('hidden');
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 1);
            } else {
                section.classList.add('fade-out');
                setTimeout(() => {
                    section.classList.add('hidden');
                    section.classList.remove('fade-out');
                }, 300);
            }
        });

        document.getElementById('addImageBtn').addEventListener('click', function() {
            const container = document.getElementById('diaryImagesContainer');
            const inputDiv = document.createElement('div');
            inputDiv.className = 'album-image-input fade-in';
            inputDiv.innerHTML = `
                <input type="text" name="diaryImage[]" placeholder="图片文件名或外部链接"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                <button type="button" class="remove-image bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg transition-smooth">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            `;
            container.appendChild(inputDiv);

            // 添加删除功能
            inputDiv.querySelector('.remove-image').addEventListener('click', function() {
                const item = this.parentElement;
                item.classList.add('fade-out');
                setTimeout(() => {
                    item.remove();
                }, 300);
            });
        });

        // 相册类型切换
        document.querySelectorAll('input[name="albumType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const section = document.getElementById('externalAlbumSection');
                if(this.value === 'external') {
                    section.classList.remove('hidden');
                    setTimeout(() => {
                        section.classList.add('fade-in');
                    }, 1);
                } else {
                    section.classList.add('fade-out');
                    setTimeout(() => {
                        section.classList.add('hidden');
                        section.classList.remove('fade-out');
                    }, 300);
                }
            });
        });

        // 添加相册图片功能
        document.getElementById('addPhotoBtn').addEventListener('click', function() {
            const container = document.getElementById('photosContainer');
            const inputDiv = document.createElement('div');
            inputDiv.className = 'album-image-input fade-in';
            inputDiv.innerHTML = `
                <input type="text" name="photoSrc[]" placeholder="图片链接"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">
                <button type="button" class="remove-photo bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg transition-smooth">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            `;
            container.appendChild(inputDiv);

            // 添加删除功能
            inputDiv.querySelector('.remove-photo').addEventListener('click', function() {
                const item = this.parentElement;
                item.classList.add('fade-out');
                setTimeout(() => {
                    item.remove();
                }, 300);
            });
        });

        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 为日期输入框设置默认值
        document.getElementById('normalPublished').value = getCurrentDate();
        document.getElementById('diaryDate').value = getCurrentDate();
        document.getElementById('albumDate').value = getCurrentDate();

        // 生成内容函数 - 简化版本，只更新内容部分，保留原metadata
        function generateMarkdown(type) {
            // 获取原始内容
            const originalContent = localStorage.getItem('originalContent') || '';

            if (originalContent) {
                // 分离frontmatter和内容
                const lines = originalContent.split('\n');
                let frontmatterStart = -1;
                let frontmatterEnd = -1;

                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].trim() === '---') {
                        if (frontmatterStart === -1) {
                            frontmatterStart = i;
                        } else {
                            frontmatterEnd = i;
                            break;
                        }
                    }
                }

                if (frontmatterStart !== -1 && frontmatterEnd !== -1) {
                    // 提取frontmatter和内容
                    const frontmatter = lines.slice(frontmatterStart, frontmatterEnd + 1).join('\n');
                    const originalContentText = lines.slice(frontmatterEnd + 1).join('\n');

                    // 根据类型获取新内容
                    let newContent = '';
                    switch(type) {
                        case 'normal':
                            newContent = document.getElementById('normalContent').value || originalContentText;
                            break;
                        case 'diary':
                            newContent = document.getElementById('diaryContent').value || originalContentText;
                            break;
                        case 'album':
                            // 对于相册，使用描述内容或保持原内容
                            newContent = document.getElementById('albumDescription').value || originalContentText;
                            break;
                    }

                    // 组合frontmatter和新内容
                    const updatedContent = `${frontmatter}\n\n${newContent}`;

                    // 显示在结果区域
                    document.getElementById('markdownResult').textContent = updatedContent;

                    // 设置文件名和其他信息
                    const editSlug = localStorage.getItem('editingSlug');
                    const editType = localStorage.getItem('editingType');

                    if (editSlug && editType) {
                        document.getElementById('fileName').value = editSlug + '.md';
                        document.getElementById('fileDirectory').value =
                            editType === 'post' ? 'src/content/posts' :
                            editType === 'diary' ? 'src/content/diary' : 'src/content/albums';
                    }

                    return;
                }
            }

            // 如果没有原始内容，使用原来的逻辑构建
            let title, date, description, tags = [], category, content;
            const extraFields = {};

            switch(type) {
                case 'normal': // 帖子
                    title = '未命名文档';
                    date = getCurrentDate();
                    content = document.getElementById('normalContent').value;
                    extraFields.published = date; // 添加published字段以确保构建成功
                    break;

                case 'diary': // 日记
                    title = '日记条目';
                    date = getCurrentDate();
                    content = document.getElementById('diaryContent').value;
                    extraFields.date = date; // 为日记类型添加日期字段
                    break;

                case 'album': // 相册
                    title = '相册';
                    date = getCurrentDate();
                    description = document.getElementById('albumDescription').value;
                    content = description || `# ${title}\n\n这是一个相册页面`;
                    break;
            }

            // 构建Frontmatter
            let frontmatter = `---\ntitle: "${title}"`;

            // 对于帖子类型，添加published字段
            if (type === 'normal') {
                frontmatter += `\npublished: ${date}`;
            }
            // 相册和日记类型不需要published字段

            if(description) frontmatter += `\ndescription: "${description}"`;
            if(category) frontmatter += `\ncategory: "${category}"`;
            if(tags.length > 0) frontmatter += `\ntags: [${tags.map(tag => `"${tag}"`).join(', ')}]`;

            // 添加额外字段
            Object.entries(extraFields).forEach(([key, value]) => {
                if(value !== undefined && value !== "" && value !== null) {
                    // 跳过已显式添加的字段，避免重复
                    if (type === 'normal' && key === 'published') {
                        return; // published字段已添加，跳过
                    }

                    if(typeof value === 'string' && value !== "") {
                        frontmatter += `\n${key}: "${value}"`;
                    } else if(typeof value === 'boolean') {
                        frontmatter += `\n${key}: ${value}`;
                    } else if(Array.isArray(value) && value.length > 0) {
                        frontmatter += `\n${key}: [${value.map(v => `"${v}"`).join(', ')}]`;
                    } else if(typeof value === 'number') {
                        frontmatter += `\n${key}: ${value}`;
                    } else if(typeof value === 'object' && value !== null) {
                        frontmatter += `\n${key}: ${JSON.stringify(value, null, 2).split('\n').join('\n  ')}`;
                    }
                }
            });

            frontmatter += '\n---\n\n';

            // 最终内容 = Frontmatter + 内容
            const fullContent = frontmatter + content;

            // 设置文件名
            const slug = title.toLowerCase()
                             .replace(/[^\w\s\u4e00-\u9fff]/g, '')  // 允许字母、数字、空格和中文字符
                             .replace(/\s+/g, '-');                // 空格替换为短横线

            document.getElementById('fileName').value = slug ? `${date}-${slug}.md` : `${date}-untitled.md`;

            document.getElementById('fileDirectory').value =
                type === 'normal' ? 'src/content/posts' :
                type === 'diary' ? 'src/content/diary' : 'src/content/albums';

            // 显示在结果区域
            document.getElementById('markdownResult').textContent = fullContent;
        }

        // 解析简单frontmatter的辅助函数
        function parseSimpleFrontmatter(frontmatterText) {
            const result = {};
            const lines = frontmatterText.split('\n');
            let currentKey = '';
            let multilineValue = '';
            let inMultiline = false;

            for (const line of lines) {
                if (line.trim() === '') continue;

                if (line.startsWith('  ') && inMultiline) {
                    // 多行数据的一部分
                    multilineValue += '\n' + line;
                } else {
                    if (inMultiline) {
                        // 结束多行数据处理
                        result[currentKey] = parseSimpleValue(multilineValue.trim());
                        inMultiline = false;
                    }

                    const match = line.match(/^([^:]+):\s*(.*)/);
                    if (match) {
                        const key = match[1].trim();
                        let value = match[2].trim();

                        if (value === '' && line.endsWith(':')) {
                            // 多行数组或对象的开始
                            currentKey = key;
                            inMultiline = true;
                            multilineValue = line + '\n';
                        } else {
                            // 解析单行值
                            result[key] = parseSimpleValue(value);
                        }
                    }
                }
            }

            // 处理最后的多行值
            if (inMultiline) {
                result[currentKey] = parseSimpleValue(multilineValue);
            }

            return result;
        }

        // 解析简单值的辅助函数
        function parseSimpleValue(value) {
            if (value.startsWith('"') && value.endsWith('"')) {
                return value.substring(1, value.length - 1);
            } else if (value.startsWith("'") && value.endsWith("'")) {
                return value.substring(1, value.length - 1);
            } else if (value === 'true') {
                return true;
            } else if (value === 'false') {
                return false;
            } else if (!isNaN(value) && value.trim() !== '') {
                const num = Number(value);
                return isNaN(num) ? value : num;
            } else if (value.startsWith('[') && value.endsWith(']')) {
                // 解析数组
                const arrayContent = value.substring(1, value.length - 1).trim();
                if (arrayContent === '') return [];

                const items = arrayContent.split(',').map(item => item.trim());
                return items.map(item => {
                    if (item.startsWith('"') && item.endsWith('"')) {
                        return item.substring(1, item.length - 1);
                    } else if (item.startsWith("'") && item.endsWith("'")) {
                        return item.substring(1, item.length - 1);
                    } else if (item === 'true') {
                        return true;
                    } else if (item === 'false') {
                        return false;
                    } else if (!isNaN(item)) {
                        const num = Number(item);
                        return isNaN(num) ? item : num;
                    }
                    return item;
                });
            } else {
                return value;
            }
        }

        // 为提交按钮添加事件监听器
        document.getElementById('normalSubmitButton').addEventListener('click', () => generateMarkdown('normal'));
        document.getElementById('diarySubmitButton').addEventListener('click', () => generateMarkdown('diary'));
        document.getElementById('albumSubmitButton').addEventListener('click', () => generateMarkdown('album'));

        // 为所有输入字段添加实时预览功能
        const inputs = document.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            if (input.type !== 'checkbox' && input.type !== 'radio') {
                input.addEventListener('input', function() {
                    // 获取当前活动的表单
                    const activeForm = document.querySelector('.form-content:not(.hidden)');
                    if (activeForm) {
                        const formType = activeForm.id.replace('Form', '');
                        generateMarkdown(formType);
                    }
                });
            }
        });

        // 为复选框添加监听
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const activeForm = document.querySelector('.form-content:not(.hidden)');
                if (activeForm) {
                    const formType = activeForm.id.replace('Form', '');
                    generateMarkdown(formType);
                }
            });
        });

        // 为单选按钮添加监听
        const radios = document.querySelectorAll('input[type="radio"]');
        radios.forEach(radio => {
            radio.addEventListener('change', function() {
                const activeForm = document.querySelector('.form-content:not(.hidden)');
                if (activeForm) {
                    const formType = activeForm.id.replace('Form', '');
                    generateMarkdown(formType);
                }
            });
        });

        // 复制功能
        document.getElementById('copyButton').addEventListener('click', function() {
            const code = document.getElementById('markdownResult').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fa fa-check mr-1" aria-hidden="true"></i>已复制';
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 2000);
            });
        });

        // 显示密钥输入模态框
        function showTokenModal() {
            document.getElementById('tokenModal').classList.add('active');
            document.getElementById('tokenInput').focus();
        }

        // 隐藏密钥输入模态框
        function hideTokenModal() {
            document.getElementById('tokenModal').classList.remove('active');
            document.getElementById('tokenInput').value = '';
        }

        // 显示提交反馈模态框
        function showFeedbackModal(message) {
            document.getElementById('feedbackText').textContent = message;
            document.getElementById('feedbackModal').classList.add('active');
        }

        // 隐藏提交反馈模态框
        function hideFeedbackModal() {
            document.getElementById('feedbackModal').classList.remove('active');
        }

        // 显示成功提示模态框
        function showSuccessModal(message) {
            // 确保之前的反馈模态框已关闭
            hideFeedbackModal();
            // 设置成功信息并显示成功模态框
            document.getElementById('successText').textContent = message;
            document.getElementById('successModal').classList.add('active');
            // 自动关闭模态框
            setTimeout(() => {
                if (document.getElementById('successModal').classList.contains('active')) {
                    hideSuccessModal();
                }
            }, 3000); // 3秒后自动关闭
        }

        // 隐藏成功提示模态框
        function hideSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        // 提交到GitHub功能
        document.getElementById('saveToGithub').addEventListener('click', async function() {
            const content = document.getElementById('markdownResult').textContent;
            const fileName = document.getElementById('fileName').value;
            const directory = document.getElementById('fileDirectory').value;

            if (!content || !fileName) {
                alert('请先生成内容并填写文件名');
                return;
            }

            // 检查认证状态
            let token = localStorage.getItem('github_access_token');

            if (!token) {
                // 显示自定义密钥输入模态框
                showTokenModal();
                return;
            }

            // 开始提交过程
            showFeedbackModal('正在验证密钥...');

            try {
                // 验证令牌
                const validateResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!validateResponse.ok) {
                    const tokenResponse = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${token}`
                        }
                    });

                    if (!tokenResponse.ok) {
                        hideFeedbackModal();
                        localStorage.removeItem('github_access_token'); // 移除无效令牌
                        throw new Error('认证令牌无效或已过期，请重新输入');
                    }
                }

                // 构建完整路径
                const filePath = `${directory}/${fileName}`;

                // 更新反馈信息
                showFeedbackModal('正在读取文件信息...');

                // 读取当前文件以获取SHA（如果文件已存在）
                let sha = null;
                try {
                    const response = await fetch(`https://api.github.com/repos/Doulor/Blog/contents/${filePath}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    console.log('文件不存在，将创建新文件');
                }

                // 使用可靠的方法正确编码内容以支持中文字符
                const encoder = new TextEncoder();
                const utf8Bytes = encoder.encode(content);
                let binaryString = '';
                for (let i = 0; i < utf8Bytes.length; i++) {
                    binaryString += String.fromCharCode(utf8Bytes[i]);
                }
                const base64Content = btoa(binaryString);

                // 准备提交数据
                const commitData = {
                    message: `添加/更新 ${filePath} [通过内容管理器]`,
                    content: base64Content,
                    branch: 'main'
                };

                if (sha) {
                    commitData.sha = sha; // 如果文件存在，需要提供SHA
                }

                // 更新反馈信息
                showFeedbackModal('正在提交文件到GitHub...');

                // 提交文件
                const result = await fetch(`https://api.github.com/repos/Doulor/Blog/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(commitData)
                });

                const resultData = await result.json();

                if (!result.ok) {
                    throw new Error(resultData.message || `HTTP ${result.status}: ${result.statusText}`);
                }

                // 成功提交
                hideFeedbackModal(); // 隐藏之前的加载模态框
                showFeedbackModal('提交成功！');
                setTimeout(() => {
                    hideFeedbackModal();
                    showSuccessModal('文件已成功提交到GitHub仓库！');
                }, 1500);
            } catch (error) {
                hideFeedbackModal(); // 隐藏加载模态框
                console.error('提交错误:', error);
                if (error.message.includes('Bad credentials') || error.message.includes('401')) {
                    localStorage.removeItem('github_access_token'); // 移除无效令牌
                    alert('认证令牌无效或已过期，请重新输入');
                    showTokenModal();
                } else if (error.message.includes('fetch') || error.message.includes('network')) {
                    alert('网络连接错误，请检查网络连接后重试');
                } else {
                    alert('提交过程中发生错误: ' + error.message);
                }
            }
        });

        // 密钥输入模态框事件监听
        document.getElementById('submitTokenBtn').addEventListener('click', async function() {
            const token = document.getElementById('tokenInput').value;
            const saveToken = document.getElementById('saveTokenCheckbox').checked;

            if (!token) {
                alert('请输入访问令牌');
                return;
            }

            // 如果选择保存令牌，则保存到本地存储
            if (saveToken) {
                localStorage.setItem('github_access_token', token);
            }

            // 验证令牌
            showFeedbackModal('正在验证密钥...');
            try {
                const validateResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!validateResponse.ok) {
                    const tokenResponse = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${token}`
                        }
                    });

                    if (!tokenResponse.ok) {
                        hideFeedbackModal();
                        localStorage.removeItem('github_access_token'); // 移除无效令牌
                        throw new Error('认证令牌无效或已过期，请重新输入');
                    }
                }

                hideFeedbackModal(); // 隐藏验证模态框

                // 隐藏模态框
                hideTokenModal();

                // 重新调用提交逻辑
                const content = document.getElementById('markdownResult').textContent;
                const fileName = document.getElementById('fileName').value;
                const directory = document.getElementById('fileDirectory').value;

                if (!content || !fileName) {
                    alert('请先生成内容并填写文件名');
                    return;
                }

                showFeedbackModal('正在提交文件到GitHub...');

                const filePath = `${directory}/${fileName}`;

                // 读取当前文件以获取SHA（如果文件已存在）
                let sha = null;
                try {
                    const response = await fetch(`https://api.github.com/repos/Doulor/Blog/contents/${filePath}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    console.log('文件不存在，将创建新文件');
                }

                // 使用可靠的方法正确编码内容以支持中文字符
                const encoder = new TextEncoder();
                const utf8Bytes = encoder.encode(content);
                let binaryString = '';
                for (let i = 0; i < utf8Bytes.length; i++) {
                    binaryString += String.fromCharCode(utf8Bytes[i]);
                }
                const base64Content = btoa(binaryString);

                // 准备提交数据
                const commitData = {
                    message: `添加/更新 ${filePath} [通过内容管理器]`,
                    content: base64Content,
                    branch: 'main'
                };

                if (sha) {
                    commitData.sha = sha; // 如果文件存在，需要提供SHA
                }

                // 提交文件
                const result = await fetch(`https://api.github.com/repos/Doulor/Blog/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(commitData)
                });

                const resultData = await result.json();

                if (!result.ok) {
                    throw new Error(resultData.message || `HTTP ${result.status}: ${result.statusText}`);
                }

                // 成功提交
                hideFeedbackModal(); // 隐藏之前的加载模态框
                showFeedbackModal('提交成功！');
                setTimeout(() => {
                    hideFeedbackModal();
                    showSuccessModal('文件已成功提交到GitHub仓库！');
                }, 1500);
            } catch (error) {
                hideFeedbackModal(); // 隐藏加载模态框
                console.error('提交错误:', error);
                if (error.message.includes('Bad credentials') || error.message.includes('401')) {
                    localStorage.removeItem('github_access_token'); // 移除无效令牌
                    alert('认证令牌无效或已过期，请重新输入');
                    showTokenModal();
                } else if (error.message.includes('fetch') || error.message.includes('network')) {
                    alert('网络连接错误，请检查网络连接后重试');
                } else {
                    alert('提交过程中发生错误: ' + error.message);
                }
            }
        });

        // 取消密钥输入事件监听
        document.getElementById('cancelTokenBtn').addEventListener('click', function() {
            hideTokenModal();
        });

        // 点击模态框外部区域关闭模态框
        document.getElementById('tokenModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideTokenModal();
            }
        });

        document.getElementById('feedbackModal').addEventListener('click', function(e) {
            if (e.target === this) {
                // 不允许通过点击外部关闭反馈模态框，因为它代表正在处理中
            }
        });

        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideSuccessModal();
            }
        });

        // 检查是否从内容管理器传递了编辑内容
        function checkForEditContent() {
            // 检查本地存储中是否有编辑内容
            const editContent = localStorage.getItem('editContent');
            const editType = localStorage.getItem('editingType');
            const editSlug = localStorage.getItem('editingSlug');

            if (editContent && editType) {
                // 解析Frontmatter
                const lines = editContent.split('\n');
                let frontmatterStart = -1;
                let frontmatterEnd = -1;

                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].trim() === '---') {
                        if (frontmatterStart === -1) {
                            frontmatterStart = i;
                        } else {
                            frontmatterEnd = i;
                            break;
                        }
                    }
                }

                if (frontmatterStart !== -1 && frontmatterEnd !== -1) {
                    const frontmatterLines = lines.slice(frontmatterStart + 1, frontmatterEnd);
                    const frontmatter = frontmatterLines.join('\n');
                    const content = lines.slice(frontmatterEnd + 1).join('\n');

                    // 解析frontmatter
                    const parsedFrontmatter = parseFrontmatter(frontmatter);

                    // 根据编辑类型决定使用哪个选项卡
                    if (editType === 'diary') {
                        document.getElementById('diaryTab').click();
                    } else if (editType === 'album') {
                        document.getElementById('albumTab').click();
                    } else {
                        document.getElementById('normalTab').click();
                    }

                    // 填充表单字段
                    populateForm(parsedFrontmatter, content, editType, editSlug + '.md');

                    // 清除localStorage中的编辑信息
                    localStorage.removeItem('editContent');
                    localStorage.removeItem('editingType');
                    localStorage.removeItem('editingSlug');
                    localStorage.removeItem('editingFilePath');
                }
            } else {
                // 如果没有编辑内容，说明是创建新内容，使用默认值
                document.getElementById('normalPublished').value = getCurrentDate();
                document.getElementById('diaryDate').value = getCurrentDate();
                document.getElementById('albumDate').value = getCurrentDate();
                generateMarkdown('normal'); // 默认显示帖子格式
            }
        }

        // 修正内容提交中的编码问题
        function encodeContentForSubmission(content) {
            // 使用TextEncoder来正确处理UTF-8编码
            const encoder = new TextEncoder();
            const data = encoder.encode(content);
            // 正确转换为base64
            let binary = '';
            const len = data.byteLength;
            for (let i = 0; i < len; i++) {
              binary += String.fromCharCode(data[i]);
            }
            return btoa(binary);
        }

        // 修正内容解码显示问题
        function decodeContentFromStorage(content) {
            // 直接返回内容，不需要额外的解码，因为存储到localStorage时已经是正确的
            return content;
        }

        // 解析Frontmatter的辅助函数
        function parseFrontmatter(frontmatter) {
            const result = {};
            const lines = frontmatter.split('\n');
            let currentKey = '';
            let multilineValue = '';
            let inMultiline = false;

            for (const line of lines) {
                if (line.trim() === '') continue;

                if (line.startsWith('  ') && inMultiline) {
                    // 这是多行数据的一部分
                    multilineValue += '\n' + line;
                } else {
                    if (inMultiline) {
                        // 结束多行数据处理
                        result[currentKey] = parseMultilineValue(multilineValue);
                        inMultiline = false;
                    }

                    const match = line.match(/^([^:]+):\s*(.*)/);
                    if (match) {
                        const key = match[1].trim();
                        let value = match[2].trim();

                        if (value === '' && line.endsWith(':')) {
                            // 可能是多行数据的开始
                            currentKey = key;
                            inMultiline = true;
                            multilineValue = line + '\n';
                        } else {
                            // 解析单行值
                            result[key] = parseValue(value);
                        }
                    }
                }
            }

            // 处理最后的多行值
            if (inMultiline) {
                result[currentKey] = parseMultilineValue(multilineValue);
            }

            return result;
        }

        // 解析值的辅助函数
        function parseValue(value) {
            if (value.startsWith('"') && value.endsWith('"')) {
                return value.substring(1, value.length - 1);
            } else if (value.startsWith("'") && value.endsWith("'")) {
                return value.substring(1, value.length - 1);
            } else if (value === 'true') {
                return true;
            } else if (value === 'false') {
                return false;
            } else if (!isNaN(value)) {
                return Number(value);
            } else if (value.startsWith('[') && value.endsWith(']')) {
                // 简单解析数组
                const arrayContent = value.substring(1, value.length - 1);
                const items = arrayContent.split(',').map(item => item.trim());
                return items.map(item => {
                    if (item.startsWith('"') && item.endsWith('"')) {
                        return item.substring(1, item.length - 1);
                    } else if (item.startsWith("'") && item.endsWith("'")) {
                        return item.substring(1, item.length - 1);
                    }
                    return item;
                });
            } else {
                return value;
            }
        }

        // 解析多行值的辅助函数
        function parseMultilineValue(multilineValue) {
            // 移除开头的键定义
            const lines = multilineValue.split('\n');
            const result = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                if (line.trim() === '') continue;

                // 解析相册照片格式
                if (line.trim().startsWith('-')) {
                    const photo = {};
                    // 偲测是相册照片格式
                    if (line.includes('src:')) {
                        const srcMatch = line.match(/src:\s*"([^"]*)"/);
                        if (srcMatch) photo.src = srcMatch[1];
                    }
                    if (line.includes('alt:')) {
                        const altMatch = line.match(/alt:\s*"([^"]*)"/);
                        if (altMatch) photo.alt = altMatch[1];
                    }
                    if (line.includes('title:')) {
                        const titleMatch = line.match(/title:\s*"([^"]*)"/);
                        if (titleMatch) photo.title = titleMatch[1];
                    }
                    if (line.includes('description:')) {
                        const descMatch = line.match(/description:\s*"([^"]*)"/);
                        if (descMatch) photo.description = descMatch[1];
                    }
                    if (line.includes('date:')) {
                        const dateMatch = line.match(/date:\s*"([^"]*)"/);
                        if (dateMatch) photo.date = dateMatch[1];
                    }
                    if (line.includes('location:')) {
                        const locationMatch = line.match(/location:\s*"([^"]*)"/);
                        if (locationMatch) photo.location = locationMatch[1];
                    }
                    if (line.includes('width:')) {
                        const widthMatch = line.match(/width:\s*(\d+)/);
                        if (widthMatch) photo.width = parseInt(widthMatch[1]);
                    }
                    if (line.includes('height:')) {
                        const heightMatch = line.match(/height:\s*(\d+)/);
                        if (heightMatch) photo.height = parseInt(heightMatch[1]);
                    }
                    if (line.includes('camera:')) {
                        const cameraMatch = line.match(/camera:\s*"([^"]*)"/);
                        if (cameraMatch) photo.camera = cameraMatch[1];
                    }
                    if (line.includes('lens:')) {
                        const lensMatch = line.match(/lens:\s*"([^"]*)"/);
                        if (lensMatch) photo.lens = lensMatch[1];
                    }
                    if (line.includes('settings:')) {
                        const settingsMatch = line.match(/settings:\s*"([^"]*)"/);
                        if (settingsMatch) photo.settings = settingsMatch[1];
                    }

                    if (Object.keys(photo).length > 0) {
                        result.push(photo);
                    }
                }
            }

            return result;
        }

        // 填充表单的辅助函数
        function populateForm(frontmatter, content, type, fileName) {
            // 设置文件名
            if (document.getElementById('fileName')) {
                document.getElementById('fileName').value = fileName;
            }

            // 填充表单字段
            switch(type) {
                case 'diary':
                    if (document.getElementById('diaryTitle')) document.getElementById('diaryTitle').value = frontmatter.title || '';
                    if (document.getElementById('diaryDate')) document.getElementById('diaryDate').value = frontmatter.date || getCurrentDate();
                    if (document.getElementById('diaryContent')) document.getElementById('diaryContent').value = content || '';

                    // 处理图片
                    if (frontmatter.images && Array.isArray(frontmatter.images) && frontmatter.images.length > 0) {
                        if (document.getElementById('diaryUseImage')) {
                            document.getElementById('diaryUseImage').checked = true;
                            const section = document.getElementById('diaryImageSection');
                            if (section) {
                                section.classList.remove('hidden');
                                setTimeout(() => section.classList.add('fade-in'), 1);
                            }

                            // 添加图片输入框
                            frontmatter.images.forEach(image => {
                                const container = document.getElementById('diaryImagesContainer');
                                if (container) {
                                    const inputDiv = document.createElement('div');
                                    inputDiv.className = 'album-image-input fade-in';
                                    inputDiv.innerHTML =
                                        '<input type="text" name="diaryImage[]" value="' + image + '" placeholder="图片文件名或外部链接"' +
                                            'class="flex-1 px-4 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">' +
                                        '<button type="button" class="remove-image bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg transition-smooth">' +
                                            '<i class="fa fa-times" aria-hidden="true"></i>' +
                                        '</button>';
                                    container.appendChild(inputDiv);

                                    // 添加删除功能
                                    inputDiv.querySelector('.remove-image').addEventListener('click', function() {
                                        const item = this.parentElement;
                                        item.classList.add('fade-out');
                                        setTimeout(() => item.remove(), 300);
                                    });
                                }
                            });
                        }
                    }
                    break;

                case 'album':
                    if (document.getElementById('albumTitle')) document.getElementById('albumTitle').value = frontmatter.title || '';
                    if (document.getElementById('albumId')) document.getElementById('albumId').value = frontmatter.id || (frontmatter.title ? frontmatter.title.toLowerCase().replace(/\s+/g, '-') : 'new-album');
                    if (document.getElementById('albumDate')) document.getElementById('albumDate').value = frontmatter.date || getCurrentDate();
                    if (document.getElementById('albumDescription')) document.getElementById('albumDescription').value = frontmatter.description || '';
                    if (document.getElementById('albumLocation')) document.getElementById('albumLocation').value = frontmatter.location || '';
                    if (document.getElementById('albumTags') && frontmatter.tags && Array.isArray(frontmatter.tags)) {
                        document.getElementById('albumTags').value = frontmatter.tags.join(', ');
                    }
                    if (document.getElementById('albumLayout')) document.getElementById('albumLayout').value = frontmatter.layout || 'grid';
                    if (document.getElementById('albumColumns')) document.getElementById('albumColumns').value = frontmatter.columns || 3;
                    if (document.getElementById('albumCover')) document.getElementById('albumCover').value = frontmatter.cover || '';

                    // 处理隐藏属性
                    if (document.getElementById('albumHidden') && frontmatter.hidden !== undefined) {
                        document.getElementById('albumHidden').checked = frontmatter.hidden;
                    }

                    // 处理相册类型
                    if (frontmatter.mode === 'external') {
                        const externalRadio = document.querySelector('input[name="albumType"][value="external"]');
                        if (externalRadio) externalRadio.click();
                    }

                    // 处理照片
                    if (frontmatter.photos && Array.isArray(frontmatter.photos)) {
                        const container = document.getElementById('photosContainer');
                        if (container) {
                            frontmatter.photos.forEach(photo => {
                                const inputDiv = document.createElement('div');
                                inputDiv.className = 'album-image-input fade-in';
                                inputDiv.innerHTML =
                                    '<input type="text" name="photoSrc[]" value="' + (photo.src || '') + '" placeholder="图片链接"' +
                                        'class="flex-1 px-4 py-2 rounded-lg border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-smooth">' +
                                    '<button type="button" class="remove-photo bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg transition-smooth">' +
                                        '<i class="fa fa-times" aria-hidden="true"></i>' +
                                    '</button>';
                                container.appendChild(inputDiv);

                                // 添加删除功能
                                inputDiv.querySelector('.remove-photo').addEventListener('click', function() {
                                    const item = this.parentElement;
                                    item.classList.add('fade-out');
                                    setTimeout(() => item.remove(), 300);
                                });
                            });
                        }
                    }
                    break;

                case 'post':
                default:
                    if (document.getElementById('normalTitle')) document.getElementById('normalTitle').value = frontmatter.title || '';
                    if (document.getElementById('normalPublished')) document.getElementById('normalPublished').value = frontmatter.published || frontmatter.date || getCurrentDate();
                    if (document.getElementById('normalDescription')) document.getElementById('normalDescription').value = frontmatter.description || '';
                    if (document.getElementById('normalTags') && frontmatter.tags && Array.isArray(frontmatter.tags)) {
                        document.getElementById('normalTags').value = frontmatter.tags.join(', ');
                    }
                    if (document.getElementById('normalCategory')) document.getElementById('normalCategory').value = frontmatter.category || '';

                    // 处理图片
                    if (frontmatter.image && document.getElementById('normalUseImage')) {
                        document.getElementById('normalUseImage').checked = true;
                        document.getElementById('normalImage').value = frontmatter.image;
                        const section = document.getElementById('normalImageSection');
                        if (section) {
                            section.classList.remove('hidden');
                            setTimeout(() => section.classList.add('fade-in'), 1);
                        }
                    }

                    // 处理草稿
                    if (frontmatter.draft !== undefined && document.getElementById('normalDraft')) {
                        document.getElementById('normalDraft').checked = frontmatter.draft;
                    }

                    // 处理置顶
                    if (frontmatter.pinned !== undefined && document.getElementById('normalPinned')) {
                        document.getElementById('normalPinned').checked = frontmatter.pinned;
                    }

                    // 处理密码保护
                    if (frontmatter.password && document.getElementById('normalUsePassword')) {
                        document.getElementById('normalUsePassword').checked = true;
                        document.getElementById('normalPassword').value = frontmatter.password;
                        const section = document.getElementById('normalPasswordSection');
                        if (section) {
                            section.classList.remove('hidden');
                            setTimeout(() => section.classList.add('fade-in'), 1);
                        }
                    }

                    if (document.getElementById('normalContent')) document.getElementById('normalContent').value = content || '';
                    break;
            }

            // 生成Markdown预览
            generateMarkdown(type === 'post' ? 'normal' : type);
        }

        // 页面加载完成后检查是否有编辑内容
        document.addEventListener('DOMContentLoaded', checkForEditContent);

        // 暴露函数给全局作用域
        window.getCurrentDate = getCurrentDate;
        window.generateMarkdown = generateMarkdown;
    </script>
</body>
</html>